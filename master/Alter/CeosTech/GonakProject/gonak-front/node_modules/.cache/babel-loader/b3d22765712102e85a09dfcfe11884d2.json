{"ast":null,"code":"import _regeneratorRuntime from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from\"react\";import{Button,FormControl,IconButton,Input,InputLabel,makeStyles,Select,MenuItem// Modal,\n}from\"@material-ui/core\";import NavigateNextIcon from\"@material-ui/icons/NavigateNext\";import useForm from\"../../../hooks/useForm\";import\"./paiement.css\";import{sendrequest}from\"../../../middlewares/request\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{useSelector,useDispatch}from\"react-redux\";import{selectBaskets,emptyBasket}from\"../../../app/Redux-slices/basketsSlice\";//import spinner from \"../images/spinner.gif\";\nimport{calculPrixProduitAvecQuantite,calculTotal}from\"../../../utilities\";import{useHistory}from\"react-router-dom\";import{useLocation}from\"react-router-dom\";import axios from\"axios\";import Modal from\"../Carte/MyModal/Modal\";import{URL}from\"../../../middlewares/request\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:{display:\"flex\",flexWrap:\"wrap\",justifyContent:\"center\"},margin:{margin:theme.spacing(1,0)},marginLeftRight:{marginRight:theme.spacing(1),marginLeft:theme.spacing(1)},withoutLabel:{marginTop:theme.spacing(3)},textField:{width:\"25ch\"},buttonIcon:{paddingLeft:1},border:{\"& label.Mui-focused\":{color:\"#ccc\"},\"& .MuiInput-underline:after\":{borderBottomColor:\"#ccc\"},\"& .MuiOutlinedInput-root\":{\"&:hover fieldset\":{borderColor:\"#ccc\"},\"&.Mui-focused fieldset\":{borderColor:\"#ccc\"}}}};});// variable arbitraire pour effectuer des tests\nvar initial={nom:\"\",prenom:\"\",email:\"\",num_tel:\"\",adresse:\"\",ville:\"\",code_postale:\"\",montant:0};var Paiement=function Paiement(props){// With location we can retrieve the kind of delivery chosen (was passed in props of history)\nvar location=useLocation();var _useState=useState(\"livraison\"),_useState2=_slicedToArray(_useState,2),paiment_process=_useState2[0],setPaiement_process=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showModal=_useState4[0],setShowModal=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),processing=_useState10[0],setProcessing=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),succeeded=_useState12[0],setSucceeded=_useState12[1];// const [supplements, setSupplements] = useState([]);\nvar stripe=useStripe();var elements=useElements();var history=useHistory();var dispatch=useDispatch();var baskets=useSelector(selectBaskets);console.log(\"baskets\",baskets);var classes=useStyles();var typeOfDelivery=location.delivery!==undefined?location.delivery.value:\"veuillez choisir un mode de livraison dans le panier\";var estValide=function estValide(){var fieldValues=arguments.length>0&&arguments[0]!==undefined?arguments[0]:state;var validator={};if(\"nom\"in fieldValues)validator.nom=state.nom?null:\"le champ nom est obligatore\";if(\"prenom\"in fieldValues)validator.prenom=state.prenom?null:\"le champ prenom est obligatore\";if(\"email\"in fieldValues)validator.email=/([a-zA-Z0-9-_.+]{4,})@.+\\..+/.test(email)?null:\"Email n'est pas valide\";if(\"num_tel\"in fieldValues)validator.num_tel=/(?:(\\+([0-9]{1,2})?)[ \\x2D]?)?\\(?([0-9]{3})\\)?[\\t-\\r \\x2D\\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]?([0-9]{3})[ \\x2D]?([0-9]{4})/.test(num_tel)?null:\"Numéro de téléphone n'est pas valide\";if(\"adresse\"in fieldValues)validator.adresse=state.adresse?null:\"le champ adresse est obligatore\";if(\"ville\"in fieldValues)validator.ville=state.ville?null:\"le champ ville est obligatore\";if(\"code_postale\"in fieldValues)validator.code_postale=/\\d+/.test(code_postale)?null:\"Code postale n'est pas valide\";if(location.delivery===undefined)validator.delivery=\"Veuillez choisir un mode de livraison dans le panier\";setErrors(_objectSpread({},validator));// retourne boolean si et seulement si on passe un parametre pour la fonction\nif(fieldValues===state){return Object.values(validator).every(function(el){return!el;});}};var _useForm=useForm(initial,estValide),state=_useForm.state,handleInputChange=_useForm.handleInputChange,errors=_useForm.errors,setErrors=_useForm.setErrors,reinitialiserState=_useForm.reinitialiserState;var nom=state.nom,prenom=state.prenom,email=state.email,num_tel=state.num_tel,adresse=state.adresse,ville=state.ville,code_postale=state.code_postale;var prixTotale=calculTotal(baskets);var montant=parseInt(prixTotale.toFixed(2),10);var handleSubmit=function handleSubmit(e){e.preventDefault();if(estValide()){setPaiement_process(\"paiement\");}};var handleChange=function handleChange(event){// Listen for changes in CardElement\n// and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");};// Fonction liée au paiement ainsi qu'à l'enregistrement des infos du clients\nvar Payer=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _yield$axios$post,data,billing_details,payload,menus,produits,_data,config;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();setProcessing(true);_context.next=4;return axios.post(URL+\"paiement/create-client-secret\",{amount:parseInt((prixTotale*100).toFixed(2),10),email:email});case 4:_yield$axios$post=_context.sent;data=_yield$axios$post.data;// *100 : stripe prend l'unité en centimes\n// 3€ -> 300 centimes\nbilling_details={name:nom+\" \"+prenom,address:{city:ville,country:\"fr\",state:null,line1:adresse,line2:null,postal_code:code_postale},email:email,phone:num_tel};_context.prev=7;_context.next=10;return stripe.confirmCardPayment(data.clientSecret,{payment_method:{card:elements.getElement(CardElement),billing_details:billing_details}});case 10:payload=_context.sent;if(payload.error){setError(\"Paiement \\xE9chou\\xE9: \".concat(payload.error.message));setProcessing(false);}else{setError(null);setProcessing(false);setDisabled(false);setSucceeded(true);menus=[];produits=[];baskets.forEach(function(item){var supp=JSON.stringify({sauce:item.sauceSelected,supplements:item.supplementSelected,garniture:item.garnitureSelected,boisson:item.boissonSelected,painSelected:item.painSelected,prixPizzaSelected:item.prix,viande_1_selected:item.viande_1_selected,viande_2_selected:item.viande_2_selected,viande_3_selected:item.viande_3_selected});produits.push({produit_id:item.id,quantite:item.quantite,information:item.information,supplements:supp});});_data={client:{nom:nom,prenom:prenom,email:email,telephone:num_tel,adresse:adresse,ville:ville,code_postale:code_postale,montant:prixTotale},panier:{menus:menus,infos_menus:JSON.stringify(menus),produits:produits},methode_vente:typeOfDelivery,commentaire:location.delivery.comment,// à voir\nprix_totale:prixTotale};config={headers:{\"Content-Type\":\"application/json\"}};sendrequest(\"post\",\"paiement/create-commande\",null,null,_data)//commande partie resto\n.then(function(response){if(response!==false){reinitialiserState();dispatch(emptyBasket());history.replace(\"/felicitation\",{payer:true});}else{setError(\"Un problème s'est produit lors du paiement, veuillez réessayer\");}});}_context.next=16;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](7);case 16:case\"end\":return _context.stop();}}},_callee,null,[[7,14]]);}));return function Payer(_x){return _ref.apply(this,arguments);};}();var handleClose=function handleClose(e){if(e.target.classList.contains(\"myModal__backdrop\")||e.target.classList.contains(\"myModal__modal__close-btn\")||e.target.parentNode.classList.contains(\"myModal__modal__close-btn\")||e.target.parentNode.parentNode.classList.contains(\"myModal__modal__close-btn\")){setShowModal(false);}};var handleOpen=function handleOpen(){setShowModal(true);};useEffect(function(){console.log(\"baskets de paiement \\xE0 linterieru\",baskets);},[baskets]);return/*#__PURE__*/_jsx(\"div\",{className:\"paiment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Paiement\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__process\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__process--option1 paiement__process--options active\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"1\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Adresse de facturation\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__process--option2 paiement__process--options \"+(paiment_process===\"paiement\"?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"span\",{children:\"2\"}),/*#__PURE__*/_jsx(\"p\",{children:\"D\\xE9tails de paiement\"})]})]}),paiment_process===\"livraison\"?/*#__PURE__*/_jsxs(\"form\",{noValidate:true,autoComplete:\"off\",onSubmit:handleSubmit,style:{flexDirection:\"column\"},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Nom\"}),/*#__PURE__*/_jsx(Input,{value:nom,name:\"nom\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.nom}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Prenom\"}),/*#__PURE__*/_jsx(Input,{value:prenom,name:\"prenom\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.prenom}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Adresse Mail\"}),/*#__PURE__*/_jsx(Input,{type:\"email\",name:\"email\",onChange:handleInputChange,value:email,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.email}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Num\\xE9ro de T\\xE9l\\xE9phone\"}),/*#__PURE__*/_jsx(Input,{value:num_tel,name:\"num_tel\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.num_tel}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Adresse\"}),/*#__PURE__*/_jsx(Input,{value:adresse,name:\"adresse\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.adresse}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \").concat(classes.marginLeftRight),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Ville\"}),/*#__PURE__*/_jsx(Input,{value:ville,name:\"ville\",onChange:handleInputChange,required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.ville})]}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \").concat(classes.marginLeftRight),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Code Postal\"}),/*#__PURE__*/_jsx(Input,{value:code_postale,name:\"code_postale\",onChange:handleInputChange,required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.code_postale})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delivery-infos__container\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__delivery-informations\",children:[\"Choix de livraison : \",typeOfDelivery]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.delivery})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",className:\"paiement--btn\",endIcon:/*#__PURE__*/_jsx(NavigateNextIcon,{}),children:\"Suivant\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__recapitualitfs\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"R\\xE9capitulatif de commande\"}),baskets.map(function(product){return/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__product__details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__product__details-info\",children:[/*#__PURE__*/_jsx(\"p\",{children:product.nom}),/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__details__product__details-info-quantite\",children:[\"Quantit\\xE9: \",/*#__PURE__*/_jsxs(\"span\",{children:[\" \",product.quantite,\" \"]}),\" \"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"paiement__details__product__details-prix\",children:/*#__PURE__*/_jsxs(\"p\",{children:[calculPrixProduitAvecQuantite(product),\"\\u20AC\"]})})]},product.nom);}),/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__recapitualitfs-total\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"TOTAL (TTC)\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__details__recapitualitfs-total-prix\",children:[prixTotale,\"\\u20AC\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__modePaiement\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Paiement s\\xE9curis\\xE9 par carte bancaire\"}),/*#__PURE__*/_jsx(\"p\",{children:\"CB et VISA accept\\xE9es\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"paiement__form\",children:[/*#__PURE__*/_jsx(CardElement,{id:\"card-element\",onChange:handleChange,options:cardStyle}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__error\",children:[\"* \",error]}),baskets.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"paiement__details__error\",children:\"* Vous n'avez rien dans le panier\"}),/*#__PURE__*/_jsx(Button,{onClick:Payer,disabled:prixTotale<=1||processing||disabled||succeeded,type:\"submit\",variant:\"contained\",color:\"primary\",className:\"paiement--btn-payer\",children:/*#__PURE__*/_jsx(\"span\",{className:\"paiement--btn-payer-text\",children:processing?{/* <img src={spinner} alt=\"spinner\" /> */}:/*#__PURE__*/_jsxs(_Fragment,{children:[\"Payer \",prixTotale,\"\\u20AC\"]})})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__details__securise\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-lock\"}),\" Paiement 100% s\\xE9curis\\xE9\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"paiement__close\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleOpen,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"paiement__back \"+(paiment_process===\"paiement\"?\"active\":\"\"),children:/*#__PURE__*/_jsx(IconButton,{onClick:function onClick(){return setPaiement_process(\"livraison\");},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-left\"})})}),/*#__PURE__*/_jsxs(Modal,{closeButton:false,showModal:showModal,setShowModal:setShowModal,handleClose:handleClose,children:[/*#__PURE__*/_jsx(Modal.Header,{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Etes-vous s\\xFBr de vouloir quitter cette page et retourner \\xE0 l'\\xE9cran de commande ?\"})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:handleClose,className:\"myModal__modal__close-btn\",children:\"Annuler\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",style:{marginLeft:\"20px\"},className:\"myModal__modal__close-btn\",onClick:function onClick(e){handleClose(e);history.replace(\"/commander\");},children:\"Oui\"})]})]})]})});};var cardStyle={style:{base:{color:\"#32325d\",fontFamily:\"Roboto, Open Sans, Segoe UI, sans-serif\",fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#aaa\",backgroundColor:\"#fff\"},\":-webkit-autofill\":{color:\"#fff\"},\":focus\":{color:\"#aaa\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}},hidePostalCode:true};export default Paiement;","map":{"version":3,"sources":["/home/christopher/Documents/Alter/GonakProject/gonak-front/src/components/site/Panier/Paiement.js"],"names":["useState","useEffect","Button","FormControl","IconButton","Input","InputLabel","makeStyles","Select","MenuItem","NavigateNextIcon","useForm","sendrequest","CardElement","useStripe","useElements","useSelector","useDispatch","selectBaskets","emptyBasket","calculPrixProduitAvecQuantite","calculTotal","useHistory","useLocation","axios","Modal","URL","useStyles","theme","root","display","flexWrap","justifyContent","margin","spacing","marginLeftRight","marginRight","marginLeft","withoutLabel","marginTop","textField","width","buttonIcon","paddingLeft","border","color","borderBottomColor","borderColor","initial","nom","prenom","email","num_tel","adresse","ville","code_postale","montant","Paiement","props","location","paiment_process","setPaiement_process","showModal","setShowModal","error","setError","disabled","setDisabled","processing","setProcessing","succeeded","setSucceeded","stripe","elements","history","dispatch","baskets","console","log","classes","typeOfDelivery","delivery","undefined","value","estValide","fieldValues","state","validator","test","setErrors","Object","values","every","el","handleInputChange","errors","reinitialiserState","prixTotale","parseInt","toFixed","handleSubmit","e","preventDefault","handleChange","event","empty","message","Payer","post","amount","data","billing_details","name","address","city","country","line1","line2","postal_code","phone","confirmCardPayment","clientSecret","payment_method","card","getElement","payload","menus","produits","forEach","item","supp","JSON","stringify","sauce","sauceSelected","supplements","supplementSelected","garniture","garnitureSelected","boisson","boissonSelected","painSelected","prixPizzaSelected","prix","viande_1_selected","viande_2_selected","viande_3_selected","push","produit_id","id","quantite","information","client","telephone","panier","infos_menus","methode_vente","commentaire","comment","prix_totale","config","headers","then","response","replace","payer","handleClose","target","classList","contains","parentNode","handleOpen","flexDirection","map","product","cardStyle","length","style","base","fontFamily","fontSmoothing","fontSize","backgroundColor","invalid","iconColor","hidePostalCode"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\n\nimport {\n  Button,\n  FormControl,\n  IconButton,\n  Input,\n  InputLabel,\n  makeStyles,\n  Select,\n  MenuItem,\n  // Modal,\n} from \"@material-ui/core\";\nimport NavigateNextIcon from \"@material-ui/icons/NavigateNext\";\nimport useForm from \"../../../hooks/useForm\";\n\nimport \"./paiement.css\";\n\nimport { sendrequest } from \"../../../middlewares/request\";\n\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectBaskets, emptyBasket } from \"../../../app/Redux-slices/basketsSlice\";\n//import spinner from \"../images/spinner.gif\";\nimport { calculPrixProduitAvecQuantite, calculTotal } from \"../../../utilities\";\nimport { useHistory } from \"react-router-dom\";\nimport { useLocation } from \"react-router-dom\";\nimport axios from \"axios\";\nimport Modal from \"../Carte/MyModal/Modal\";\nimport { URL } from \"../../../middlewares/request\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    justifyContent: \"center\",\n  },\n  margin: {\n    margin: theme.spacing(1, 0),\n  },\n  marginLeftRight: {\n    marginRight: theme.spacing(1),\n    marginLeft: theme.spacing(1),\n  },\n  withoutLabel: {\n    marginTop: theme.spacing(3),\n  },\n  textField: {\n    width: \"25ch\",\n  },\n\n  buttonIcon: {\n    paddingLeft: 1,\n  },\n\n  border: {\n    \"& label.Mui-focused\": {\n      color: \"#ccc\",\n    },\n    \"& .MuiInput-underline:after\": {\n      borderBottomColor: \"#ccc\",\n    },\n\n    \"& .MuiOutlinedInput-root\": {\n      \"&:hover fieldset\": {\n        borderColor: \"#ccc\",\n      },\n      \"&.Mui-focused fieldset\": {\n        borderColor: \"#ccc\",\n      },\n    },\n  },\n}));\n\n// variable arbitraire pour effectuer des tests\nconst initial = {\n  nom: \"\",\n  prenom: \"\",\n  email: \"\",\n  num_tel: \"\",\n  adresse: \"\",\n  ville: \"\",\n  code_postale: \"\",\n  montant: 0,\n};\n\nconst Paiement = (props) => {\n  // With location we can retrieve the kind of delivery chosen (was passed in props of history)\n  const location = useLocation();\n\n  const [paiment_process, setPaiement_process] = useState(\"livraison\");\n  const [showModal, setShowModal] = useState(false);\n\n  const [error, setError] = useState(null);\n  const [disabled, setDisabled] = useState(true);\n  const [processing, setProcessing] = useState(false);\n  const [succeeded, setSucceeded] = useState(false);\n  // const [supplements, setSupplements] = useState([]);\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const history = useHistory();\n\n  const dispatch = useDispatch();\n  const baskets = useSelector(selectBaskets);\n  console.log(`baskets`, baskets);\n\n  const classes = useStyles();\n\n  const typeOfDelivery =\n    location.delivery !== undefined\n      ? location.delivery.value\n      : \"veuillez choisir un mode de livraison dans le panier\";\n\n  const estValide = (fieldValues = state) => {\n    const validator = {};\n    if (\"nom\" in fieldValues)\n      validator.nom = state.nom ? null : \"le champ nom est obligatore\";\n    if (\"prenom\" in fieldValues)\n      validator.prenom = state.prenom ? null : \"le champ prenom est obligatore\";\n\n    if (\"email\" in fieldValues)\n      validator.email = /([a-zA-Z0-9-_.+]{4,})@.+\\..+/.test(email)\n        ? null\n        : \"Email n'est pas valide\";\n\n    if (\"num_tel\" in fieldValues)\n      validator.num_tel =\n        /(?:(\\+(\\d{1,2})?)[ -]?)?\\(?(?<first>\\d{3})\\)?[-\\s]?(\\d{3})[- ]?(\\d{4})/.test(\n          num_tel\n        )\n          ? null\n          : \"Numéro de téléphone n'est pas valide\";\n\n    if (\"adresse\" in fieldValues)\n      validator.adresse = state.adresse\n        ? null\n        : \"le champ adresse est obligatore\";\n    if (\"ville\" in fieldValues)\n      validator.ville = state.ville ? null : \"le champ ville est obligatore\";\n\n    if (\"code_postale\" in fieldValues)\n      validator.code_postale = /\\d+/.test(code_postale)\n        ? null\n        : \"Code postale n'est pas valide\";\n\n    if (location.delivery === undefined)\n      validator.delivery =\n        \"Veuillez choisir un mode de livraison dans le panier\";\n\n    setErrors({ ...validator });\n\n    // retourne boolean si et seulement si on passe un parametre pour la fonction\n    if (fieldValues === state) {\n      return Object.values(validator).every((el) => !el);\n    }\n  };\n\n  const { state, handleInputChange, errors, setErrors, reinitialiserState } =\n    useForm(initial, estValide);\n\n  const { nom, prenom, email, num_tel, adresse, ville, code_postale } = state;\n\n  const prixTotale = calculTotal(baskets);\n\n  const montant = parseInt(prixTotale.toFixed(2), 10);\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    if (estValide()) {\n      setPaiement_process(\"paiement\");\n    }\n  };\n\n  const handleChange = (event) => {\n    // Listen for changes in CardElement\n    // and display any errors as the customer types their card details\n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n  };\n\n  // Fonction liée au paiement ainsi qu'à l'enregistrement des infos du clients\n  const Payer = async (e) => {\n    e.preventDefault();\n\n    setProcessing(true);\n\n    const { data } = await axios.post(URL + \"paiement/create-client-secret\", {\n      amount: parseInt((prixTotale * 100).toFixed(2), 10),\n      email,\n    });\n    // *100 : stripe prend l'unité en centimes\n    // 3€ -> 300 centimes\n\n    const billing_details = {\n      name: nom + \" \" + prenom,\n      address: {\n        city: ville,\n        country: \"fr\",\n        state: null,\n        line1: adresse,\n        line2: null,\n        postal_code: code_postale,\n      },\n      email,\n      phone: num_tel,\n    };\n\n    try {\n      const payload = await stripe.confirmCardPayment(data.clientSecret, {\n        payment_method: {\n          card: elements.getElement(CardElement),\n          billing_details,\n        },\n      });\n      if (payload.error) {\n        setError(`Paiement échoué: ${payload.error.message}`);\n        setProcessing(false);\n      } else {\n        setError(null);\n        setProcessing(false);\n        setDisabled(false);\n        setSucceeded(true);\n\n        const menus = [];\n        const produits = [];\n\n        baskets.forEach((item) => {\n          const supp = JSON.stringify({\n            sauce: item.sauceSelected,\n            supplements: item.supplementSelected,\n            garniture: item.garnitureSelected,\n            boisson: item.boissonSelected,\n            painSelected: item.painSelected,\n            prixPizzaSelected: item.prix,\n            viande_1_selected: item.viande_1_selected,\n            viande_2_selected: item.viande_2_selected,\n            viande_3_selected: item.viande_3_selected,\n          });\n          produits.push({\n            produit_id: item.id,\n            quantite: item.quantite,\n            information: item.information,\n            supplements: supp,\n          });\n        });\n\n        const data = {\n          client: {\n            nom,\n            prenom,\n            email,\n            telephone: num_tel,\n            adresse,\n            ville,\n            code_postale,\n            montant: prixTotale,\n          },\n          panier: {\n            menus: menus,\n            infos_menus: JSON.stringify(menus),\n            produits,\n          },\n          methode_vente: typeOfDelivery,\n          commentaire: location.delivery.comment, // à voir\n          prix_totale: prixTotale,\n        };\n\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        };\n\n        sendrequest(\"post\", \"paiement/create-commande\", null, null, data) //commande partie resto\n          .then((response) => {\n            if (response !== false) {\n              reinitialiserState();\n              dispatch(emptyBasket());\n              history.replace(\"/felicitation\", { payer: true });\n            } else {\n              setError(\n                \"Un problème s'est produit lors du paiement, veuillez réessayer\"\n              );\n            }\n          });\n      }\n    } catch (err) {\n      // setError(err.message);\n    }\n  };\n\n  const handleClose = (e) => {\n    if (\n      e.target.classList.contains(\"myModal__backdrop\") ||\n      e.target.classList.contains(\"myModal__modal__close-btn\") ||\n      e.target.parentNode.classList.contains(\"myModal__modal__close-btn\") ||\n      e.target.parentNode.parentNode.classList.contains(\n        \"myModal__modal__close-btn\"\n      )\n    ) {\n      setShowModal(false);\n    }\n  };\n\n  const handleOpen = () => {\n    setShowModal(true);\n  };\n\n  useEffect(() => {\n    console.log(`baskets de paiement à linterieru`, baskets);\n  }, [baskets]);\n\n  return (\n    <div className=\"paiment\">\n      <div className=\"paiement__container\">\n        <h1>Paiement</h1>\n        <div className=\"paiement__process\">\n          <div\n            className={\n              \"paiement__process--option1 paiement__process--options active\"\n            }\n          >\n            <span>1</span>\n            <p>Adresse de facturation</p>\n          </div>\n          <hr />\n          <div\n            className={\n              \"paiement__process--option2 paiement__process--options \" +\n              (paiment_process === \"paiement\" ? \"active\" : \"\")\n            }\n          >\n            <span>2</span>\n            <p>Détails de paiement</p>\n          </div>\n        </div>\n\n        {paiment_process === \"livraison\" ? (\n          <form\n            noValidate\n            autoComplete=\"off\"\n            onSubmit={handleSubmit}\n            style={{ flexDirection: \"column\" }}\n          >\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Nom</InputLabel>\n              <Input\n                value={nom}\n                name=\"nom\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.nom}</div>\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Prenom</InputLabel>\n              <Input\n                value={prenom}\n                name=\"prenom\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.prenom}</div>\n\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Adresse Mail</InputLabel>\n              <Input\n                type=\"email\"\n                name=\"email\"\n                onChange={handleInputChange}\n                value={email}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.email}</div>\n\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Numéro de Téléphone</InputLabel>\n              <Input\n                value={num_tel}\n                name=\"num_tel\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.num_tel}</div>\n\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Adresse</InputLabel>\n              <Input\n                value={adresse}\n                name=\"adresse\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.adresse}</div>\n\n            <div style={{ display: \"flex\" }}>\n              <FormControl\n                fullWidth\n                className={`${classes.margin} ${classes.border} ${classes.marginLeftRight}`}\n              >\n                <InputLabel>Ville</InputLabel>\n                <Input\n                  value={ville}\n                  name=\"ville\"\n                  onChange={handleInputChange}\n                  required\n                />\n                <div className=\"error\">{errors.ville}</div>\n              </FormControl>\n              <FormControl\n                fullWidth\n                className={`${classes.margin} ${classes.border} ${classes.marginLeftRight}`}\n              >\n                <InputLabel>Code Postal</InputLabel>\n                <Input\n                  value={code_postale}\n                  name=\"code_postale\"\n                  onChange={handleInputChange}\n                  required\n                />\n                <div className=\"error\">{errors.code_postale}</div>\n              </FormControl>\n            </div>\n\n            {/* The type of delivery chosen */}\n            <div className=\"delivery-infos__container\">\n              <p className=\"paiement__delivery-informations\">\n                Choix de livraison : {typeOfDelivery}\n              </p>\n              <div className=\"error\">{errors.delivery}</div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              variant=\"contained\"\n              color=\"primary\"\n              className=\"paiement--btn\"\n              endIcon={<NavigateNextIcon />}\n            >\n              Suivant\n            </Button>\n          </form>\n        ) : (\n          <div className=\"paiement__details\">\n            <div className=\"paiement__details__recapitualitfs\">\n              <h2>Récapitulatif de commande</h2>\n              {baskets.map((product) => (\n                <div\n                  className=\"paiement__details__product__details\"\n                  key={product.nom}\n                >\n                  <div className=\"paiement__details__product__details-info\">\n                    <p>{product.nom}</p>\n                    <p className=\"paiement__details__product__details-info-quantite\">\n                      Quantité: <span> {product.quantite} </span>{\" \"}\n                    </p>\n                  </div>\n                  <div className=\"paiement__details__product__details-prix\">\n                    <p>{calculPrixProduitAvecQuantite(product)}€</p>\n                  </div>\n                </div>\n              ))}\n              <div className=\"paiement__details__recapitualitfs-total\">\n                <p>TOTAL (TTC)</p>\n                <p className=\"paiement__details__recapitualitfs-total-prix\">\n                  {prixTotale}€\n                </p>\n              </div>\n            </div>\n\n            <div className=\"paiement__details__modePaiement\">\n              <h2>Paiement sécurisé par carte bancaire</h2>\n              <p>CB et VISA acceptées</p>\n              <form className=\"paiement__form\">\n                <CardElement\n                  id=\"card-element\"\n                  onChange={handleChange}\n                  options={cardStyle}\n                />\n                {error && (\n                  <div className=\"paiement__details__error\">* {error}</div>\n                )}\n\n                {baskets.length === 0 && (\n                  <div className=\"paiement__details__error\">\n                    * Vous n'avez rien dans le panier\n                  </div>\n                )}\n\n                <Button\n                  onClick={Payer}\n                  disabled={\n                    prixTotale <= 1 || processing || disabled || succeeded\n                  }\n                  type=\"submit\"\n                  variant=\"contained\"\n                  color=\"primary\"\n                  className=\"paiement--btn-payer\"\n                >\n                  <span className=\"paiement--btn-payer-text\">\n                    {processing ? (\n                     {/* <img src={spinner} alt=\"spinner\" /> */}\n                    ) : (\n                      <>Payer {prixTotale}€</>\n                    )}\n                  </span>\n                </Button>\n              </form>\n              <p className=\"paiement__details__securise\">\n                <i className=\"fas fa-lock\"></i> Paiement 100% sécurisé\n              </p>\n            </div>\n          </div>\n        )}\n\n        <div className=\"paiement__close\">\n          <IconButton onClick={handleOpen}>\n            <i className=\"fas fa-times\"></i>\n          </IconButton>\n        </div>\n        <div\n          className={\n            \"paiement__back \" + (paiment_process === \"paiement\" ? \"active\" : \"\")\n          }\n        >\n          <IconButton onClick={() => setPaiement_process(\"livraison\")}>\n            <i className=\"fas fa-arrow-left\"></i>\n          </IconButton>\n        </div>\n\n        <Modal\n          closeButton={false}\n          showModal={showModal}\n          setShowModal={setShowModal}\n          handleClose={handleClose}\n        >\n          <Modal.Header>\n            <h2>\n              Etes-vous sûr de vouloir quitter cette page et retourner à l'écran\n              de commande ?\n            </h2>\n          </Modal.Header>\n          <Modal.Footer>\n            <Button\n              variant=\"contained\"\n              color=\"secondary\"\n              onClick={handleClose}\n              className=\"myModal__modal__close-btn\"\n            >\n              Annuler\n            </Button>\n            <Button\n              variant=\"contained\"\n              style={{ marginLeft: \"20px\" }}\n              className=\"myModal__modal__close-btn\"\n              onClick={(e) => {\n                handleClose(e);\n                history.replace(\"/commander\");\n              }}\n            >\n              Oui\n            </Button>\n          </Modal.Footer>\n        </Modal>\n      </div>\n    </div>\n  );\n};\n\nconst cardStyle = {\n  style: {\n    base: {\n      color: \"#32325d\",\n      fontFamily: \"Roboto, Open Sans, Segoe UI, sans-serif\",\n      fontSmoothing: \"antialiased\",\n      fontSize: \"16px\",\n      \"::placeholder\": {\n        color: \"#aaa\",\n        backgroundColor: \"#fff\",\n      },\n      \":-webkit-autofill\": {\n        color: \"#fff\",\n      },\n      \":focus\": {\n        color: \"#aaa\",\n      },\n    },\n\n    invalid: {\n      color: \"#fa755a\",\n      iconColor: \"#fa755a\",\n    },\n  },\n  hidePostalCode: true,\n};\n\nexport default Paiement;\n"]},"metadata":{},"sourceType":"module"}