{"ast":null,"code":"import _regeneratorRuntime from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from\"react\";import{Button,FormControl,IconButton,Input,InputLabel,makeStyles,Select,MenuItem// Modal,\n}from\"@material-ui/core\";import NavigateNextIcon from\"@material-ui/icons/NavigateNext\";import useForm from\"../../../hooks/useForm\";import\"./paiement.css\";import{loadStripe}from\"@stripe/stripe-js\";import{Elements}from\"@stripe/react-stripe-js\";import{sendrequest}from\"../../../middlewares/request\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{useSelector,useDispatch}from\"react-redux\";import{selectBaskets,emptyBasket}from\"../../../app/Redux-slices/basketsSlice\";import{calculPrixProduitAvecQuantite,calculTotal}from\"../../../utilities\";import{useHistory}from\"react-router-dom\";import{useLocation}from\"react-router-dom\";import axios from\"axios\";import Modal from\"../Carte/MyModal/Modal\";import{URL}from\"../../../middlewares/request\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:{display:\"flex\",flexWrap:\"wrap\",justifyContent:\"center\"},margin:{margin:theme.spacing(1,0)},marginLeftRight:{marginRight:theme.spacing(1),marginLeft:theme.spacing(1)},withoutLabel:{marginTop:theme.spacing(3)},textField:{width:\"25ch\"},buttonIcon:{paddingLeft:1},border:{\"& label.Mui-focused\":{color:\"#ccc\"},\"& .MuiInput-underline:after\":{borderBottomColor:\"#ccc\"},\"& .MuiOutlinedInput-root\":{\"&:hover fieldset\":{borderColor:\"#ccc\"},\"&.Mui-focused fieldset\":{borderColor:\"#ccc\"}}}};});var initial={nom:\"\",prenom:\"\",email:\"\",num_tel:\"\",adresse:\"\",ville:\"\",code_postale:\"\"};var Paiement=function Paiement(props){var baskets=useSelector(selectBaskets);// With location we can retrieve the kind of delivery chosen (was passed in props of history)\nvar _useState=useState(\"livraison\"),_useState2=_slicedToArray(_useState,2),paiment_process=_useState2[0],setPaiement_process=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showModal=_useState4[0],setShowModal=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),processing=_useState10[0],setProcessing=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),succeeded=_useState12[0],setSucceeded=_useState12[1];var _useState13=useState(baskets.prixTotal),_useState14=_slicedToArray(_useState13,2),prixTotal=_useState14[0],setPrixTotal=_useState14[1];// const [supplements, setSupplements] = useState([]);\nvar location=useLocation();var stripe=useStripe();var elements=useElements();var history=useHistory();var dispatch=useDispatch();var classes=useStyles();console.log(baskets);var typeOfDelivery=location.delivery!==undefined?location.delivery.value:\"veuillez choisir un mode de livraison dans le panier\";var estValide=function estValide(){var fieldValues=arguments.length>0&&arguments[0]!==undefined?arguments[0]:state;var validator={};if(\"nom\"in fieldValues)validator.nom=state.nom?null:\"le champ nom est obligatore\";if(\"prenom\"in fieldValues)validator.prenom=state.prenom?null:\"le champ prenom est obligatore\";if(\"email\"in fieldValues)validator.email=/([a-zA-Z0-9-_.+]{4,})@.+\\..+/.test(email)?null:\"Email n'est pas valide\";if(\"num_tel\"in fieldValues)validator.num_tel=/(?:(\\+([0-9]{1,2})?)[ \\x2D]?)?\\(?([0-9]{3})\\)?[\\t-\\r \\x2D\\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]?([0-9]{3})[ \\x2D]?([0-9]{4})/.test(num_tel)?null:\"Numéro de téléphone n'est pas valide\";if(\"adresse\"in fieldValues)validator.adresse=state.adresse?null:\"le champ adresse est obligatore\";if(\"ville\"in fieldValues)validator.ville=state.ville?null:\"le champ ville est obligatore\";if(\"code_postale\"in fieldValues)validator.code_postale=/\\d+/.test(code_postale)?null:\"Code postale n'est pas valide\";if(location.delivery===undefined)validator.delivery=\"Veuillez choisir un mode de livraison dans le panier\";setErrors(_objectSpread({},validator));// retourne boolean si et seulement si on passe un parametre pour la fonction\nif(fieldValues===state){return Object.values(validator).every(function(el){return!el;});}};var _useForm=useForm(initial,estValide),state=_useForm.state,handleInputChange=_useForm.handleInputChange,errors=_useForm.errors,setErrors=_useForm.setErrors,reinitialiserState=_useForm.reinitialiserState;var nom=state.nom,prenom=state.prenom,email=state.email,num_tel=state.num_tel,adresse=state.adresse,ville=state.ville,code_postale=state.code_postale;var handleSubmit=function handleSubmit(e){e.preventDefault();if(estValide()){setPaiement_process(\"paiement\");}};var handleChange=function handleChange(event){// Listen for changes in CardElement\n// and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");};// Fonction liée au paiement ainsi qu'à l'enregistrement des infos du clients\nvar Payer=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _yield$axios$post,data,payload,produits,config;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return axios.post(URL+\"paiement/create-client-secret\",{amount:parseInt((calculTotal(baskets)*100).toFixed(2),10),email:email});case 3:_yield$axios$post=_context.sent;data=_yield$axios$post.data;_context.prev=5;console.log(\"test\");console.log(data);_context.next=10;return stripe.confirmCardPayment(data.clientSecret,{payment_method:{card:elements.getElement(CardElement)}});case 10:payload=_context.sent;if(!payload.error){_context.next=16;break;}setError(\"Paiement \\xE9chou\\xE9: \".concat(payload.error.message));setProcessing(false);_context.next=23;break;case 16:setError(null);setProcessing(false);//setDisabled(false);\n//etSucceeded(true);\nproduits=baskets;//const produits = [];\nconsole.log(JSON.stringify(baskets));config={headers:{\"Content-Type\":\"application/json\"}};_context.next=23;return axios.post(URL+\"paiement/create-commande\",{panier:{infos_produits:JSON.stringify(produits)//produits: [],\n},client:{nom:nom,prenom:prenom,email:email,telephone:num_tel,adresse:adresse,ville:ville,code_postale:code_postale},methode_vente:typeOfDelivery,commentaire:location.delivery.comment,prix_total:calculTotal(baskets)}).then(function(response){if(response!==false){reinitialiserState();dispatch(emptyBasket());history.replace(\"/home/felicitation\",{payer:true});}else{console.log(data);setError(\"Un problème s'est produit lors du paiement, veuillez réessayer\");}});case 23:_context.next=28;break;case 25:_context.prev=25;_context.t0=_context[\"catch\"](5);// setError(err.message);\nconsole.log(_context.t0.message);case 28:case\"end\":return _context.stop();}}},_callee,null,[[5,25]]);}));return function Payer(_x){return _ref.apply(this,arguments);};}();var handleClose=function handleClose(e){if(e.target.classList.contains(\"myModal__backdrop\")||e.target.classList.contains(\"myModal__modal__close-btn\")||e.target.parentNode.classList.contains(\"myModal__modal__close-btn\")||e.target.parentNode.parentNode.classList.contains(\"myModal__modal__close-btn\")){setShowModal(false);}};var handleOpen=function handleOpen(){setShowModal(true);};return/*#__PURE__*/_jsx(\"div\",{className:\"paiment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__container\",children:[paiment_process===\"livraison\"?/*#__PURE__*/_jsxs(\"form\",{noValidate:true,autoComplete:\"off\",onSubmit:handleSubmit,style:{flexDirection:\"column\"},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Nom\"}),/*#__PURE__*/_jsx(Input,{value:nom,name:\"nom\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.nom}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Prenom\"}),/*#__PURE__*/_jsx(Input,{value:prenom,name:\"prenom\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.prenom}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Adresse Mail\"}),/*#__PURE__*/_jsx(Input,{type:\"email\",name:\"email\",onChange:handleInputChange,value:email,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.email}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Num\\xE9ro de T\\xE9l\\xE9phone\"}),/*#__PURE__*/_jsx(Input,{value:num_tel,name:\"num_tel\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.num_tel}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \"),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Adresse\"}),/*#__PURE__*/_jsx(Input,{value:adresse,name:\"adresse\",onChange:handleInputChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.adresse}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\"},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \").concat(classes.marginLeftRight),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Ville\"}),/*#__PURE__*/_jsx(Input,{value:ville,name:\"ville\",onChange:handleInputChange,required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.ville})]}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,className:\"\".concat(classes.margin,\" \").concat(classes.border,\" \").concat(classes.marginLeftRight),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Code Postal\"}),/*#__PURE__*/_jsx(Input,{value:code_postale,name:\"code_postale\",onChange:handleInputChange,required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.code_postale})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delivery-infos__container\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__delivery-informations\",children:[\"Choix de livraison : \",typeOfDelivery]}),/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:errors.delivery})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",className:\"paiement--btn\",endIcon:/*#__PURE__*/_jsx(NavigateNextIcon,{}),children:\"Suivant\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__recapitualitfs\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"R\\xE9capitulatif de commande\"}),baskets.map(function(product){return/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__product__details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__product__details-info\",children:[/*#__PURE__*/_jsx(\"p\",{children:product.nom}),/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__details__product__details-info-quantite\",children:[\"Quantit\\xE9: \",/*#__PURE__*/_jsxs(\"span\",{children:[\" \",product.quantite,\" \"]}),\" \"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"paiement__details__product__details-prix\",children:/*#__PURE__*/_jsxs(\"p\",{children:[calculPrixProduitAvecQuantite(product),\"\\u20AC\"]})})]},product.nom);}),/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__recapitualitfs-total\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"TOTAL (TTC)\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__details__recapitualitfs-total-prix\",children:[calculTotal(baskets),\"\\u20AC\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__modePaiement\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Paiement s\\xE9curis\\xE9 par carte bancaire\"}),/*#__PURE__*/_jsx(\"p\",{children:\"CB et VISA accept\\xE9es\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"paiement__form\",children:[/*#__PURE__*/_jsx(CardElement,{id:\"card-element\",onChange:handleChange,options:cardStyle}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"paiement__details__error\",children:[\"* \",error]}),/*#__PURE__*/_jsx(Button,{onClick:Payer,variant:\"contained\",color:\"primary\",className:\"paiement--btn-payer\",children:/*#__PURE__*/_jsx(\"span\",{className:\"paiement--btn-payer-text\",children:processing?{/* <img src={spinner} alt=\"spinner\" /> */}:/*#__PURE__*/_jsxs(_Fragment,{children:[\"Payer \",calculTotal(baskets),\"\\u20AC\"]})})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"paiement__details__securise\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-lock\"}),\" Paiement 100% s\\xE9curis\\xE9\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"paiement__close\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleOpen,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"paiement__back \"+(paiment_process===\"paiement\"?\"active\":\"\"),children:/*#__PURE__*/_jsx(IconButton,{onClick:function onClick(){return setPaiement_process(\"livraison\");},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-left\"})})}),/*#__PURE__*/_jsxs(Modal,{closeButton:false,showModal:showModal,setShowModal:setShowModal,handleClose:handleClose,children:[/*#__PURE__*/_jsx(Modal.Header,{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Etes-vous s\\xFBr de vouloir quitter cette page et retourner \\xE0 l'\\xE9cran de commande ?\"})}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:handleClose,className:\"myModal__modal__close-btn\",children:\"Annuler\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",style:{marginLeft:\"20px\"},className:\"myModal__modal__close-btn\",onClick:function onClick(e){handleClose(e);history.replace(\"/home/carte\");},children:\"Oui\"})]})]})]})});};var cardStyle={style:{base:{color:\"#32325d\",fontFamily:\"Roboto, Open Sans, Segoe UI, sans-serif\",fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#aaa\",backgroundColor:\"#fff\"},\":-webkit-autofill\":{color:\"#fff\"},\":focus\":{color:\"#aaa\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}},hidePostalCode:true};export var Wrapper=function Wrapper(props){//const config = useSelector(state => state.config.info);\n//const stripe = window.Stripe(config.stripe);\nvar test=loadStripe(\"pk_test_51JQ9d2G8uFuhwMtfeIIgrp9mSsWPuVqmTeqZVNc58ukTd42QqUEsnWf8vXIXS5q6Mu6bKS2PfElbRySFMeMHTaQK00WyHNKcuX  \");return/*#__PURE__*/_jsx(Elements,{stripe:test,children:/*#__PURE__*/_jsx(Paiement,{})});};export default Wrapper;","map":{"version":3,"sources":["/home/christopher/Documents/Alter/GonakProject/gonak-front/src/components/site/Panier/Paiement.js"],"names":["useState","useEffect","Button","FormControl","IconButton","Input","InputLabel","makeStyles","Select","MenuItem","NavigateNextIcon","useForm","loadStripe","Elements","sendrequest","CardElement","useStripe","useElements","useSelector","useDispatch","selectBaskets","emptyBasket","calculPrixProduitAvecQuantite","calculTotal","useHistory","useLocation","axios","Modal","URL","useStyles","theme","root","display","flexWrap","justifyContent","margin","spacing","marginLeftRight","marginRight","marginLeft","withoutLabel","marginTop","textField","width","buttonIcon","paddingLeft","border","color","borderBottomColor","borderColor","initial","nom","prenom","email","num_tel","adresse","ville","code_postale","Paiement","props","baskets","paiment_process","setPaiement_process","showModal","setShowModal","error","setError","disabled","setDisabled","processing","setProcessing","succeeded","setSucceeded","prixTotal","setPrixTotal","location","stripe","elements","history","dispatch","classes","console","log","typeOfDelivery","delivery","undefined","value","estValide","fieldValues","state","validator","test","setErrors","Object","values","every","el","handleInputChange","errors","reinitialiserState","handleSubmit","e","preventDefault","handleChange","event","empty","message","Payer","post","amount","parseInt","toFixed","data","confirmCardPayment","clientSecret","payment_method","card","getElement","payload","produits","JSON","stringify","config","headers","panier","infos_produits","client","telephone","methode_vente","commentaire","comment","prix_total","then","response","replace","payer","handleClose","target","classList","contains","parentNode","handleOpen","flexDirection","map","product","quantite","cardStyle","style","base","fontFamily","fontSmoothing","fontSize","backgroundColor","invalid","iconColor","hidePostalCode","Wrapper"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\n\nimport {\n  Button,\n  FormControl,\n  IconButton,\n  Input,\n  InputLabel,\n  makeStyles,\n  Select,\n  MenuItem,\n  // Modal,\n} from \"@material-ui/core\";\nimport NavigateNextIcon from \"@material-ui/icons/NavigateNext\";\nimport useForm from \"../../../hooks/useForm\";\nimport \"./paiement.css\";\n\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { Elements } from \"@stripe/react-stripe-js\";\n\nimport { sendrequest } from \"../../../middlewares/request\";\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nimport { selectBaskets, emptyBasket } from \"../../../app/Redux-slices/basketsSlice\";\nimport { calculPrixProduitAvecQuantite, calculTotal } from \"../../../utilities\";\nimport { useHistory } from \"react-router-dom\";\nimport { useLocation } from \"react-router-dom\";\nimport axios from \"axios\";\nimport Modal from \"../Carte/MyModal/Modal\";\nimport { URL } from \"../../../middlewares/request\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    justifyContent: \"center\",\n  },\n  margin: {\n    margin: theme.spacing(1, 0),\n  },\n  marginLeftRight: {\n    marginRight: theme.spacing(1),\n    marginLeft: theme.spacing(1),\n  },\n  withoutLabel: {\n    marginTop: theme.spacing(3),\n  },\n  textField: {\n    width: \"25ch\",\n  },\n\n  buttonIcon: {\n    paddingLeft: 1,\n  },\n\n  border: {\n    \"& label.Mui-focused\": {\n      color: \"#ccc\",\n    },\n    \"& .MuiInput-underline:after\": {\n      borderBottomColor: \"#ccc\",\n    },\n\n    \"& .MuiOutlinedInput-root\": {\n      \"&:hover fieldset\": {\n        borderColor: \"#ccc\",\n      },\n      \"&.Mui-focused fieldset\": {\n        borderColor: \"#ccc\",\n      },\n    },\n  },\n}));\n\nconst initial = {\n  nom: \"\",\n  prenom: \"\",\n  email: \"\",\n  num_tel: \"\",\n  adresse: \"\",\n  ville: \"\",\n  code_postale: \"\",\n};\n\nconst Paiement = (props) => {\n  const baskets = useSelector(selectBaskets);\n  // With location we can retrieve the kind of delivery chosen (was passed in props of history)\n  const [paiment_process, setPaiement_process] = useState(\"livraison\");\n  const [showModal, setShowModal] = useState(false);\n  const [error, setError] = useState(null);\n  const [disabled, setDisabled] = useState(true);\n  const [processing, setProcessing] = useState(false);\n  const [succeeded, setSucceeded] = useState(false);\n  const [prixTotal, setPrixTotal] = useState(baskets.prixTotal);\n  // const [supplements, setSupplements] = useState([]);\n\n  const location = useLocation();\n  const stripe = useStripe();\n  const elements = useElements();\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const classes = useStyles();\n\n  console.log(baskets);\n\n  const typeOfDelivery =\n    location.delivery !== undefined\n      ? location.delivery.value\n      : \"veuillez choisir un mode de livraison dans le panier\";\n\n\n   const estValide = (fieldValues = state) => {\n      const validator = {};\n      if (\"nom\" in fieldValues)\n        validator.nom = state.nom ? null : \"le champ nom est obligatore\";\n      if (\"prenom\" in fieldValues)\n        validator.prenom = state.prenom ? null : \"le champ prenom est obligatore\";\n\n      if (\"email\" in fieldValues)\n        validator.email = /([a-zA-Z0-9-_.+]{4,})@.+\\..+/.test(email)\n          ? null\n          : \"Email n'est pas valide\";\n\n      if (\"num_tel\" in fieldValues)\n        validator.num_tel =\n          /(?:(\\+(\\d{1,2})?)[ -]?)?\\(?(?<first>\\d{3})\\)?[-\\s]?(\\d{3})[- ]?(\\d{4})/.test(\n            num_tel\n          )\n            ? null\n            : \"Numéro de téléphone n'est pas valide\";\n\n      if (\"adresse\" in fieldValues)\n        validator.adresse = state.adresse\n          ? null\n          : \"le champ adresse est obligatore\";\n      if (\"ville\" in fieldValues)\n        validator.ville = state.ville ? null : \"le champ ville est obligatore\";\n\n      if (\"code_postale\" in fieldValues)\n        validator.code_postale = /\\d+/.test(code_postale)\n          ? null\n          : \"Code postale n'est pas valide\";\n\n      if (location.delivery === undefined)\n        validator.delivery =\n          \"Veuillez choisir un mode de livraison dans le panier\";\n\n      setErrors({ ...validator });\n\n      // retourne boolean si et seulement si on passe un parametre pour la fonction\n      if (fieldValues === state) {\n        return Object.values(validator).every((el) => !el);\n      }\n    };\n\n  const { state, handleInputChange, errors, setErrors, reinitialiserState } =\n    useForm(initial, estValide);\n\n  const { nom, prenom, email, num_tel, adresse, ville, code_postale } = state;\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    if (estValide()) {\n      setPaiement_process(\"paiement\");\n    }\n  };\n\n \n\n  const handleChange = (event) => {\n    // Listen for changes in CardElement\n    // and display any errors as the customer types their card details\n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n  };\n\n  // Fonction liée au paiement ainsi qu'à l'enregistrement des infos du clients\n  const Payer = async (e) => {\n      e.preventDefault();\n\n      const { data } = await axios.post(URL + \"paiement/create-client-secret\", {\n        amount: parseInt((calculTotal(baskets) * 100).toFixed(2), 10),\n        email,\n      });\n\n      try \n      {\n        console.log(\"test\")\n        console.log(data)\n          const payload = await stripe.confirmCardPayment(data.clientSecret, {\n            payment_method: {\n              card: elements.getElement(CardElement),\n            },\n          });\n          if (payload.error) \n          {\n            setError(`Paiement échoué: ${payload.error.message}`);\n            setProcessing(false);\n          } \n          else \n          {\n              setError(null);\n              setProcessing(false);\n              //setDisabled(false);\n              //etSucceeded(true);\n              const produits = baskets;\n              //const produits = [];\n\n              console.log(JSON.stringify(baskets))\n\n\n              const config = {\n                headers: {\n                  \"Content-Type\": \"application/json\", \n                },\n              };\n\n              await axios.post(URL + \"paiement/create-commande\", {\n                  panier: {\n                    infos_produits: JSON.stringify(produits),\n                    //produits: [],\n                  },\n                  client: {\n                    nom,\n                    prenom,\n                    email,\n                    telephone: num_tel,\n                    adresse,\n                    ville,\n                    code_postale,\n                  },\n                  methode_vente: typeOfDelivery,\n                  commentaire: location.delivery.comment,\n                  prix_total: calculTotal(baskets),\n                })\n                .then((response) => {\n                  if (response !== false) {\n                    reinitialiserState();\n                    dispatch(emptyBasket());\n                    history.replace(\"/home/felicitation\", { payer: true });\n                  } else {\n                    console.log(data)\n                    setError(\n                      \"Un problème s'est produit lors du paiement, veuillez réessayer\"\n                    );\n                  }\n                });\n          }\n    }\n    catch (err) \n    {\n      // setError(err.message);\n      console.log(err.message)\n    }\n  };\n\n\n  const handleClose = (e) => {\n    if (\n      e.target.classList.contains(\"myModal__backdrop\") ||\n      e.target.classList.contains(\"myModal__modal__close-btn\") ||\n      e.target.parentNode.classList.contains(\"myModal__modal__close-btn\") ||\n      e.target.parentNode.parentNode.classList.contains(\n        \"myModal__modal__close-btn\"\n      )\n    ) {\n      setShowModal(false);\n    }\n  };\n\n  const handleOpen = () => {\n    setShowModal(true);\n  };\n\n  return (\n    <div className=\"paiment\">\n      <div className=\"paiement__container\">\n        {paiment_process === \"livraison\" ? (\n          <form\n            noValidate\n            autoComplete=\"off\"\n            onSubmit={handleSubmit}\n            style={{ flexDirection: \"column\" }}\n          >\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Nom</InputLabel>\n              <Input\n                value={nom}\n                name=\"nom\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.nom}</div>\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Prenom</InputLabel>\n              <Input\n                value={prenom}\n                name=\"prenom\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.prenom}</div>\n\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Adresse Mail</InputLabel>\n              <Input\n                type=\"email\"\n                name=\"email\"\n                onChange={handleInputChange}\n                value={email}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.email}</div>\n\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Numéro de Téléphone</InputLabel>\n              <Input\n                value={num_tel}\n                name=\"num_tel\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.num_tel}</div>\n\n            <FormControl\n              fullWidth\n              className={`${classes.margin} ${classes.border} `}\n            >\n              <InputLabel>Adresse</InputLabel>\n              <Input\n                value={adresse}\n                name=\"adresse\"\n                onChange={handleInputChange}\n                required\n              />\n            </FormControl>\n            <div className=\"error\">{errors.adresse}</div>\n\n            <div style={{ display: \"flex\" }}>\n              <FormControl\n                fullWidth\n                className={`${classes.margin} ${classes.border} ${classes.marginLeftRight}`}\n              >\n                <InputLabel>Ville</InputLabel>\n                <Input\n                  value={ville}\n                  name=\"ville\"\n                  onChange={handleInputChange}\n                  required\n                />\n                <div className=\"error\">{errors.ville}</div>\n              </FormControl>\n              <FormControl\n                fullWidth\n                className={`${classes.margin} ${classes.border} ${classes.marginLeftRight}`}\n              >\n                <InputLabel>Code Postal</InputLabel>\n                <Input\n                  value={code_postale}\n                  name=\"code_postale\"\n                  onChange={handleInputChange}\n                  required\n                />\n                <div className=\"error\">{errors.code_postale}</div>\n              </FormControl>\n            </div>\n\n            {/* The type of delivery chosen */}\n            <div className=\"delivery-infos__container\">\n              <p className=\"paiement__delivery-informations\">\n                Choix de livraison : {typeOfDelivery}\n              </p>\n              <div className=\"error\">{errors.delivery}</div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              variant=\"contained\"\n              color=\"primary\"\n              className=\"paiement--btn\"\n              endIcon={<NavigateNextIcon />}\n            >\n              Suivant\n            </Button>\n          </form>\n        ) : (\n          <div className=\"paiement__details\">\n            <div className=\"paiement__details__recapitualitfs\">\n              <h2>Récapitulatif de commande</h2>\n              {baskets.map((product) => (\n                <div\n                  className=\"paiement__details__product__details\"\n                  key={product.nom}\n                >\n                  <div className=\"paiement__details__product__details-info\">\n                    <p>{product.nom}</p>\n                    <p className=\"paiement__details__product__details-info-quantite\">\n                      Quantité: <span> {product.quantite} </span>{\" \"}\n                    </p>\n                  </div>\n                  <div className=\"paiement__details__product__details-prix\">\n                    <p>{calculPrixProduitAvecQuantite(product)}€</p>\n                  </div>\n                </div>\n              ))}\n              <div className=\"paiement__details__recapitualitfs-total\">\n                <p>TOTAL (TTC)</p>\n                <p className=\"paiement__details__recapitualitfs-total-prix\">\n                  {calculTotal(baskets)}€\n                </p>\n              </div>\n            </div>\n\n            <div className=\"paiement__details__modePaiement\">\n              <h2>Paiement sécurisé par carte bancaire</h2>\n              <p>CB et VISA acceptées</p>\n\n              <form className=\"paiement__form\">\n                <CardElement\n                  id=\"card-element\"\n                  onChange={handleChange}\n                  options={cardStyle}\n                />\n                {error && (\n                  <div className=\"paiement__details__error\">* {error}</div>\n                )}\n\n                <Button\n                  onClick={Payer}\n                  variant=\"contained\"\n                  color=\"primary\"\n                  className=\"paiement--btn-payer\"\n                >\n                  <span className=\"paiement--btn-payer-text\">\n                    {processing ? (\n                     {/* <img src={spinner} alt=\"spinner\" /> */}\n                    ) : (\n                      <>Payer {calculTotal(baskets)}€</>\n                    )}\n                  </span>\n                </Button>\n              </form>\n              <p className=\"paiement__details__securise\">\n                <i className=\"fas fa-lock\"></i> Paiement 100% sécurisé\n              </p>\n            </div>\n          </div>\n          )}  \n      <div className=\"paiement__close\">\n          <IconButton onClick={handleOpen}>\n            <i className=\"fas fa-times\"></i>\n          </IconButton>\n        </div>\n        <div\n          className={\n            \"paiement__back \" + (paiment_process === \"paiement\" ? \"active\" : \"\")\n          }\n        >\n          <IconButton onClick={() => setPaiement_process(\"livraison\")}>\n            <i className=\"fas fa-arrow-left\"></i>\n          </IconButton>\n        </div>\n\n        <Modal\n          closeButton={false}\n          showModal={showModal}\n          setShowModal={setShowModal}\n          handleClose={handleClose}\n        >\n          <Modal.Header>\n            <h2>\n              Etes-vous sûr de vouloir quitter cette page et retourner à l'écran\n              de commande ?\n            </h2>\n          </Modal.Header>\n          <Modal.Footer>\n            <Button\n              variant=\"contained\"\n              color=\"secondary\"\n              onClick={handleClose}\n              className=\"myModal__modal__close-btn\"\n            >\n              Annuler\n            </Button>\n            <Button\n              variant=\"contained\"\n              style={{ marginLeft: \"20px\" }}\n              className=\"myModal__modal__close-btn\"\n              onClick={(e) => {\n                handleClose(e);\n                history.replace(\"/home/carte\");\n              }}\n            >\n              Oui\n            </Button>\n          </Modal.Footer>\n        </Modal>\n      </div>\n    </div>\n  );\n};\n\n\nconst cardStyle = {\n  style: {\n    base: {\n      color: \"#32325d\",\n      fontFamily: \"Roboto, Open Sans, Segoe UI, sans-serif\",\n      fontSmoothing: \"antialiased\",\n      fontSize: \"16px\",\n      \"::placeholder\": {\n        color: \"#aaa\",\n        backgroundColor: \"#fff\",\n      },\n      \":-webkit-autofill\": {\n        color: \"#fff\",\n      },\n      \":focus\": {\n        color: \"#aaa\",\n      },\n    },\n\n    invalid: {\n      color: \"#fa755a\",\n      iconColor: \"#fa755a\",\n    },\n  },\n  hidePostalCode: true,\n};\n\n\n\nexport const Wrapper = (props) => {\n\n  //const config = useSelector(state => state.config.info);\n  //const stripe = window.Stripe(config.stripe);\n  const test = loadStripe(\"pk_test_51JQ9d2G8uFuhwMtfeIIgrp9mSsWPuVqmTeqZVNc58ukTd42QqUEsnWf8vXIXS5q6Mu6bKS2PfElbRySFMeMHTaQK00WyHNKcuX  \");\n\n  return (\n    <Elements stripe={test}>\n      <Paiement />\n    </Elements>\n  );\n}\n\nexport default Wrapper;\n"]},"metadata":{},"sourceType":"module"}