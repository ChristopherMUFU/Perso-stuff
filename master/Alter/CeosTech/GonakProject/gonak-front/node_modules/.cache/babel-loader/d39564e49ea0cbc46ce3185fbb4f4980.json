{"ast":null,"code":"import _regeneratorRuntime from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/christopher/Documents/Alter/GonakProject/gonak-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useHistory}from\"react-router-dom\";import{useState,useRef,useEffect}from\"react\";import useForm from\"../../../hooks/useForm\";import{sendrequest}from\"../../../middlewares/request\";import ModalBootsrap from\"../modal/Modal\";import{TextField}from\"@material-ui/core\";import{React}from\"react-dom\";import{Button}from\"@material-ui/core\";import FormControl from\"@material-ui/core/FormControl\";import Select from\"@material-ui/core/Select\";import InputLabel from\"@material-ui/core/InputLabel\";import MenuItem from\"@material-ui/core/MenuItem\";import axios from'axios';import{URL}from\"../../../middlewares/request\";import{Alert}from\"react-alert\";import\"./factureRegister.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var initial={montantHT:\"\",montantTVA:\"\",fournisseur:\"\",date_achat:\"\",photo_facture:null};function FactureRegister(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];var handleClose=function handleClose(){return setShow(false);};var handleShow=function handleShow(){return setShow(true);};var estValide=function estValide(){var fieldValues=arguments.length>0&&arguments[0]!==undefined?arguments[0]:state;var validator={};if(\"montantHT\"in fieldValues)validator.montantHT=state.montantHT?null:\"Le champ montant est obligatore\";if(\"montantTVA\"in fieldValues)validator.montantTVA=state.montantTVA?null:\"Le champ TVA est obligatore\";if(\"fournisseur\"in fieldValues)validator.fournisseur=state.fournisseur?null:\"Le champ fournisseur est obligatore\";if(\"date\"in fieldValues)validator.date_achat=state.date_achat?null:\"Le champ date n'est pas validé\";//   if (\"date\" in fieldValues)\n//   validator.date = /^(([0-8][0-9])|(9[0-5]))[0-9]{3}$/.test(\n//     code_postal\n//   )\n//     ? null\n//     : \"La code date n'est pas valide\";\nsetErrors(_objectSpread({},validator));// retourne boolean si et seulement si on passe un parametre pour la fonction\nif(fieldValues===state){return Object.values(validator).every(function(el){return!el;});}};var _useForm=useForm(initial,estValide),state=_useForm.state,setState=_useForm.setState,handleInputChange=_useForm.handleInputChange,errors=_useForm.errors,setErrors=_useForm.setErrors,reinitialiserState=_useForm.reinitialiserState;var montantHT=state.montantHT,montantTVA=state.montantTVA,fournisseur=state.fournisseur,date_achat=state.date_achat,photo_facture=state.photo_facture;var handleSubmit=function handleSubmit(e){e.preventDefault();console.log('state:',state);if(estValide()){//   sendrequest(\"post\", \"comptabilite/facture/\", null, null, state).then(response => {\n//     setSuccess(true); \n//     handleShow();\n//   reinitialiserState();\n// }).catch(error => {\n//   setSuccess(false);\n//   handleShow();\n//});\n// On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\nvar form_data=new FormData();form_data.append('photo_facture',state.photo_facture,state.photo_facture.name);form_data.append('montantHT',state.montantHT);form_data.append('montantTVA',state.montantTVA);form_data.append('fournisseur',state.fournisseur);form_data.append('date_achat',state.date_achat);var url=URL+\"comptabilite/facture/\";axios.post(url,form_data,{headers:{'content-type':'multipart/form-data'}}).then(function(res){setSuccess(true);handleShow();reinitialiserState();}).catch(function(err){setSuccess(false);handleShow();});};};var history=useHistory();var RedirectionInfo=function RedirectionInfo(){var url=\"/admin/Comptabilite/\";history.push(url);};// Create a reference to the hidden file input element\nvar hiddenFileInput=useRef(null);// Programatically click the hidden file input element\n// when the Button component is clicked\nvar handleClick=function handleClick(event){hiddenFileInput.current.click();};// Call a function (passed as a prop from the parent component)\n// to handle the user-selected file\nvar handleChange=function handleChange(event){var fileUploaded=event.target.files[0];// props.handleFile(fileUploaded);\nsetState(_objectSpread(_objectSpread({},state),{},{photo_facture:fileUploaded}));if(fileUploaded){alert(\"Vous avez inséré une image !\");}};var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),aujourdhui_ca=_useState6[0],setAujourdhuiCa=_useState6[1];var _useState7=useState(new Date().toLocaleDateString()),_useState8=_slicedToArray(_useState7,2),calendar=_useState8[0],setCalendar=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),calendar_ca=_useState10[0],setCalendarCa=_useState10[1];var aujourdhui=new Date().getTime();//// 11/03/2021\n//const dateFormat= \"jj/mm/aaaa\"\nvar get_suivi_jour=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(val){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setState(_objectSpread(_objectSpread({},state),{},{date_achat:val}));case 1:case\"end\":return _context.stop();}}},_callee);}));return function get_suivi_jour(_x){return _ref.apply(this,arguments);};}();var get_ca_by_calendar=function get_ca_by_calendar(e){// console.log(e.target.valueAsNumber);\n// console.log(e.target.valueAsDate);\n// console.log(new Date(e.target.valueAsNumber).toDateString()); //// Tue Mar 09 2021\nsetCalendar(new Date(e.target.valueAsNumber).getTime());var tmp=new Date(e.target.valueAsNumber).getTime();//const { debut, fin } = get_time_debut_fin(new Date(e.target.valueAsNumber));\nget_suivi_jour(tmp);};var handleTVAChange=function handleTVAChange(event){setState(_objectSpread(_objectSpread({},state),{},{montantTVA:event.target.value}));};// useEffect(() => {\n//   console.log('state:', state)\n// }, [state])\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"facture\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"facture-header\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-left\",onClick:RedirectionInfo}),/*#__PURE__*/_jsx(\"h1\",{children:\"Enregistrer une facture\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"facture_center\",children:/*#__PURE__*/_jsxs(\"form\",{className:\" facture_container\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"adresse_facture\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"facture_div\",children:[/*#__PURE__*/_jsx(TextField,{className:\"facture_input\",fullWidth:true,label:\"Montant HT en euros\",id:\"outlined-basic\",variant:\"outlined\",name:\"montantHT\",value:montantHT,onChange:handleInputChange,required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"errors\",children:errors.montantHT})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"facture_div\",children:[/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:\"facture_tva\",children:[/*#__PURE__*/_jsx(InputLabel,{id:\"demo-simple-select-outlined-label\",children:\"TVA\"}),/*#__PURE__*/_jsxs(Select,{labelId:\"demo-simple-select-outlined-label\",id:\"demo-simple-select-outlined\"//value={montantTVA}\n,onChange:handleTVAChange,label:\"Age\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",disabled:true,children:\"Chosir TVA\"}),/*#__PURE__*/_jsx(MenuItem,{value:5.5,children:\"5.5\"}),/*#__PURE__*/_jsx(MenuItem,{value:10,children:\"10\"}),/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"errors\",children:errors.montantTVA})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"facture_div\",children:[/*#__PURE__*/_jsx(TextField,{className:\"facture_input\",fullWidth:true,label:\"Fournisseur\",id:\"outlined-basic\",variant:\"outlined\",name:\"fournisseur\",value:fournisseur,onChange:handleInputChange,required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"errors\",children:errors.fournisseur})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"facture_div\",children:[/*#__PURE__*/_jsx(TextField,{type:\"date\",onChange:get_ca_by_calendar,className:\"facture_input\",fullWidth:true,id:\"outlined-basic\",variant:\"outlined\",name:\"date_achat\",required:true}),/*#__PURE__*/_jsx(\"div\",{className:\"errors\",children:errors.date_achat})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"telecharger_div\",children:[/*#__PURE__*/_jsx(Button,{fullWidth:true,onClick:handleClick,children:\"T\\xE9l\\xE9verser facture\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:hiddenFileInput,onChange:handleChange,style:{display:\"none\"}}),/*#__PURE__*/_jsx(\"div\",{className:\"errors\",children:errors.photo_facture})]}),/*#__PURE__*/_jsx(\"div\",{className:\"caisse_button\",children:/*#__PURE__*/_jsx(\"button\",{className:\"registre_facture_button\",type:\"submit\",children:\"Valider\"})}),/*#__PURE__*/_jsx(ModalBootsrap,{handleClose:handleClose,show:show,title:/*#__PURE__*/_jsxs(_Fragment,{children:[success?\"Envoyé\":\"Oups\",/*#__PURE__*/_jsx(\"i\",{className:\"\".concat(success?\" fas fa-thumbs-up\":\" fas fa-thumbs-down\"),style:{color:\"#4caf50\",marginLeft:\"1rem\"}})]}),children:success?\"Enregistrement avec succès.\":\"Une erreur s'est produite, veuillez réessayer.\"})]})})]});}export default FactureRegister;","map":{"version":3,"sources":["/home/christopher/Documents/Alter/GonakProject/gonak-front/src/components/admin/factureRegister/factureregister.js"],"names":["useHistory","useState","useRef","useEffect","useForm","sendrequest","ModalBootsrap","TextField","React","Button","FormControl","Select","InputLabel","MenuItem","axios","URL","Alert","initial","montantHT","montantTVA","fournisseur","date_achat","photo_facture","FactureRegister","props","show","setShow","success","setSuccess","handleClose","handleShow","estValide","fieldValues","state","validator","setErrors","Object","values","every","el","setState","handleInputChange","errors","reinitialiserState","handleSubmit","e","preventDefault","console","log","form_data","FormData","append","name","url","post","headers","then","res","catch","err","history","RedirectionInfo","push","hiddenFileInput","handleClick","event","current","click","handleChange","fileUploaded","target","files","alert","aujourdhui_ca","setAujourdhuiCa","Date","toLocaleDateString","calendar","setCalendar","calendar_ca","setCalendarCa","aujourdhui","getTime","get_suivi_jour","val","get_ca_by_calendar","valueAsNumber","tmp","handleTVAChange","value","display","color","marginLeft"],"mappings":"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","sourcesContent":["import { useHistory } from \"react-router-dom\";\nimport { useState, useRef, useEffect } from \"react\";\nimport useForm from \"../../../hooks/useForm\";\nimport { sendrequest } from \"../../../middlewares/request\";\nimport ModalBootsrap from \"../modal/Modal\";\nimport { TextField } from \"@material-ui/core\";\nimport { React } from \"react-dom\";\nimport { Button } from \"@material-ui/core\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport Select from \"@material-ui/core/Select\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport axios from 'axios';\nimport {URL} from \"../../../middlewares/request\";\nimport { Alert } from \"react-alert\";\n\n\nimport \"./factureRegister.css\";\n\nconst initial = {\n  montantHT: \"\",\n  montantTVA: \"\",\n  fournisseur: \"\",\n  date_achat: \"\",\n  photo_facture: null,\n};\n\nfunction FactureRegister(props) {\n  const [show, setShow] = useState(false);\n  const [success, setSuccess] = useState(false);\n\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  const estValide = (fieldValues = state) => {\n    const validator = {};\n\n    if (\"montantHT\" in fieldValues)\n      validator.montantHT = state.montantHT\n        ? null\n        : \"Le champ montant est obligatore\";\n\n    if (\"montantTVA\" in fieldValues)\n      validator.montantTVA = state.montantTVA ? null : \"Le champ TVA est obligatore\";\n\n    if (\"fournisseur\" in fieldValues)\n      validator.fournisseur = state.fournisseur\n        ? null\n        : \"Le champ fournisseur est obligatore\";\n\n    if (\"date\" in fieldValues)\n      validator.date_achat = state.date_achat ? null : \"Le champ date n'est pas validé\";\n\n    //   if (\"date\" in fieldValues)\n    //   validator.date = /^(([0-8][0-9])|(9[0-5]))[0-9]{3}$/.test(\n    //     code_postal\n    //   )\n    //     ? null\n    //     : \"La code date n'est pas valide\";\n\n    setErrors({ ...validator });\n\n    // retourne boolean si et seulement si on passe un parametre pour la fonction\n    if (fieldValues === state) {\n      return Object.values(validator).every((el) => !el);\n    }\n  };\n\n  const { state, setState, handleInputChange, errors, setErrors, reinitialiserState } =\n    useForm(initial, estValide);\n\n  const { montantHT, montantTVA, fournisseur, date_achat, photo_facture } = state;\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    console.log('state:', state)\n    if (estValide()){\n    //   sendrequest(\"post\", \"comptabilite/facture/\", null, null, state).then(response => {\n    //     setSuccess(true); \n    //     handleShow();\n    //   reinitialiserState();\n    // }).catch(error => {\n    //   setSuccess(false);\n    //   handleShow();\n    //});\n    \n\n    // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n    let form_data = new FormData();\n    form_data.append('photo_facture', state.photo_facture, state.photo_facture.name);\n    form_data.append('montantHT', state.montantHT);\n    form_data.append('montantTVA', state.montantTVA);\n    form_data.append('fournisseur', state.fournisseur);\n    form_data.append('date_achat', state.date_achat);\n    let url = URL+\"comptabilite/facture/\";\n\n    axios.post(url, form_data, {\n      headers: {\n        'content-type': 'multipart/form-data'\n      }\n    })\n        .then(res => {\n          setSuccess(true); \n          handleShow();\n         reinitialiserState();\n        })\n        .catch(err => {\n          setSuccess(false);\n          handleShow();\n        })\n  };\n\n    \n  };\n\n  const history = useHistory();\n\n  const RedirectionInfo = () => {\n    let url = \"/admin/Comptabilite/\";\n    history.push(url);\n  };\n  // Create a reference to the hidden file input element\n  const hiddenFileInput = useRef(null);\n\n  // Programatically click the hidden file input element\n  // when the Button component is clicked\n  const handleClick = (event) => {\n    hiddenFileInput.current.click();\n  };\n  // Call a function (passed as a prop from the parent component)\n  // to handle the user-selected file\n  const handleChange = (event) => {\n    const fileUploaded = event.target.files[0];\n    // props.handleFile(fileUploaded);\n    setState({...state,photo_facture:fileUploaded})\n    if (fileUploaded){\n      alert(\"Vous avez inséré une image !\")\n    }\n  };\n\n  const [aujourdhui_ca, setAujourdhuiCa] = useState(null);\n  const [calendar, setCalendar] = useState(new Date().toLocaleDateString());\n  const [calendar_ca, setCalendarCa] = useState(null);\n\n  const aujourdhui = new Date().getTime(); //// 11/03/2021\n\n  //const dateFormat= \"jj/mm/aaaa\"\n\n  const get_suivi_jour = async (val) => {\n    setState({...state, date_achat:val})\n  };\n\n\n  const get_ca_by_calendar = (e) => {\n    // console.log(e.target.valueAsNumber);\n    // console.log(e.target.valueAsDate);\n    // console.log(new Date(e.target.valueAsNumber).toDateString()); //// Tue Mar 09 2021\n\n    setCalendar(new Date(e.target.valueAsNumber).getTime());\n    let tmp = new Date(e.target.valueAsNumber).getTime()\n    //const { debut, fin } = get_time_debut_fin(new Date(e.target.valueAsNumber));\n    get_suivi_jour(tmp);\n  };\n\n  const handleTVAChange=(event)=>{\n    setState({...state,montantTVA:event.target.value})\n  }\n\n  // useEffect(() => {\n  //   console.log('state:', state)\n   \n  // }, [state])\n\n  return (\n    \n    <div className=\"facture\">\n      <div className=\"facture-header\">\n        <i className=\"fas fa-arrow-left\" onClick={RedirectionInfo}></i>\n        <h1>Enregistrer une facture</h1>\n      </div>\n\n      <div className=\"facture_center\" >\n      <form className=\" facture_container\" onSubmit={handleSubmit}>\n        <div className=\"adresse_facture\">\n          <div className=\"facture_div\">\n            <TextField\n              className=\"facture_input\"\n              fullWidth\n              label=\"Montant HT en euros\"\n              id=\"outlined-basic\"\n              variant=\"outlined\"\n              name=\"montantHT\"\n              value={montantHT}\n              onChange={handleInputChange}\n              required\n            />\n            <div className=\"errors\">{errors.montantHT}</div>\n          </div>\n\n          <div className=\"facture_div\">\n            <FormControl variant=\"outlined\" className=\"facture_tva\">\n              <InputLabel id=\"demo-simple-select-outlined-label\">\n                TVA\n              </InputLabel>\n              <Select\n                labelId=\"demo-simple-select-outlined-label\"\n                id=\"demo-simple-select-outlined\"\n                //value={montantTVA}\n                onChange={handleTVAChange}\n                label=\"Age\"\n              >\n                <MenuItem value=\"\" disabled>Chosir TVA</MenuItem>\n                <MenuItem value={5.5}>5.5</MenuItem>\n                <MenuItem value={10}>10</MenuItem>\n                <MenuItem value={20}>20</MenuItem>\n              </Select>\n            </FormControl>\n            <div className=\"errors\">{errors.montantTVA}</div>\n          </div>\n        </div>\n\n        <div className=\"facture_div\">\n          <TextField\n            className=\"facture_input\"\n            fullWidth\n            label=\"Fournisseur\"\n            id=\"outlined-basic\"\n            variant=\"outlined\"\n            name=\"fournisseur\"\n            value={fournisseur}\n            onChange={handleInputChange}\n            required\n          />\n          <div className=\"errors\">{errors.fournisseur}</div>\n        </div>\n\n        <div className=\"facture_div\">\n          {/* <TextField\n            className=\"facture_input\"\n            fullWidth\n            id=\"outlined-basic\"\n            variant=\"outlined\"\n            name=\"date_achat\"\n            type=\"date\"\n            value={date_achat}\n            onChange={handleInputChange}\n            required\n          /> */}\n          <TextField type='date' onChange={get_ca_by_calendar} \n          className=\"facture_input\"\n          fullWidth\n          id=\"outlined-basic\"\n          variant=\"outlined\"\n          name=\"date_achat\"\n          required/>\n          <div className=\"errors\">{errors.date_achat}</div>\n        </div>\n\n        <div className=\"telecharger_div\">\n          <Button fullWidth onClick={handleClick}>\n            Téléverser facture\n          </Button>\n          <input\n            type=\"file\"\n            ref={hiddenFileInput}\n            onChange={handleChange}\n            style={{ display: \"none\" }}\n          />\n          <div className=\"errors\">{errors.photo_facture}</div>\n        </div>\n\n        <div className=\"caisse_button\">\n          <button className=\"registre_facture_button\" type=\"submit\">\n            Valider\n          </button>\n        </div>\n\n        <ModalBootsrap\n          handleClose={handleClose}\n          show={show}\n          title={\n            <>\n              {success ? \"Envoyé\" : \"Oups\"}\n              <i\n                className={`${\n                  success ? \" fas fa-thumbs-up\" : \" fas fa-thumbs-down\"\n                }`}\n                style={{ color: \"#4caf50\", marginLeft: \"1rem\" }}\n              ></i>\n            </>\n          }\n        >\n          {success\n            ? \"Enregistrement avec succès.\"\n            : \"Une erreur s'est produite, veuillez réessayer.\"}\n        </ModalBootsrap>\n      </form>\n      </div>\n    </div>\n    \n  );\n}\nexport default FactureRegister;\n"]},"metadata":{},"sourceType":"module"}