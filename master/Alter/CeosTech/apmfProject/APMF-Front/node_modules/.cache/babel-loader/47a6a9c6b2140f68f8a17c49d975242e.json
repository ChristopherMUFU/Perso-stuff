{"ast":null,"code":"var _jsxFileName = \"/home/christopher/Documents/Alter/apmfProject/APMF-Front/src/components/admin/journalFabry/JournalFabry.js\",\n    _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport { useState, useRef } from \"react\";\nimport { URL } from \"../../../middlewares/request\";\nimport { extractFilesNames } from \"../../../utilities\";\nimport useForm from \"../../../hooks/useForm\";\nimport { TextField, Button } from \"@material-ui/core\";\nimport { CKEditor } from \"@ckeditor/ckeditor5-react\";\nimport ClassicEditor from \"ckeditor5-custom-build/build/ckeditor\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport ModalBootsrap from \"../../modal/Modal\";\nimport { useLocation } from \"react-router-dom\"; //styles des elements html\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  root: {\n    minWidth: \"300px\",\n    padding: \"0 2rem\"\n  },\n  flex: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    margin: \"2rem 0\"\n  },\n  inputsContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    margin: \"0.5rem\"\n  },\n  h2: {\n    textAlign: \"center\"\n  },\n  button: {\n    backgroundColor: \"white\",\n    border: \"2px solid blue\"\n  },\n  blueIcon: {\n    backgroundColor: \"blue\",\n    border: \"2px solid blue\",\n    borderRadius: \"7px\"\n  },\n  buttonContainer: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    marginTop: \"1.5rem\"\n  },\n  divTextOverflow: {\n    width: \"16rem\",\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\"\n  }\n})); // configuration de l'editeur du texte\n\nconst editorConfiguration = {\n  toolbar: {\n    items: [\"fontFamily\", \"fontColor\", \"fontBackgroundColor\", \"heading\", \"|\", \"bold\", \"italic\", \"|\", \"alignment:left\", \"alignment:center\", \"alignment:right\", \"alignment:justify\", \"|\", \"underline\", \"highlight\", \"horizontalLine\", \"pageBreak\", \"link\", \"bulletedList\", \"numberedList\", \"|\", \"outdent\", \"indent\", \"|\", \"findAndReplace\", // \"imageUpload\",\n    // \"imageInsert\",\n    \"blockQuote\", \"insertTable\", // \"mediaEmbed\",\n    \"undo\", \"redo\"],\n    shouldNotGroupWhenFull: true\n  },\n  language: \"fr\",\n  image: {\n    toolbar: [\"imageTextAlternative\", \"imageStyle:full\", \"imageStyle:side\", \"linkImage\"]\n  },\n  table: {\n    contentToolbar: [\"tableColumn\", \"tableRow\", \"mergeTableCells\"]\n  },\n  placeholder: \"Entrer votre texte ici...\"\n};\nexport default function JournalFabry() {\n  _s();\n\n  var _location$state, _journal$photo2, _journal$document;\n\n  const [show, setShow] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [imageUpdated, setImageUpdated] = useState(false);\n  const [journalUpdated, setJournalUpdated] = useState(false);\n  const [isSending, setIsSending] = useState(false);\n  const classes = useStyles();\n  const location = useLocation();\n  const journalToUpdate = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.journalToUpdate;\n  const {\n    imageNameToUpdate,\n    documentNameToUpdate\n  } = extractFilesNames(journalToUpdate); //pour la defaultValue de date d'apparution\n\n  const today_date = `${new Date().toISOString().substr(0, 10)}T${new Date().toLocaleTimeString([], {\n    hour: \"2-digit\",\n    minute: \"2-digit\"\n  })}`;\n  const initialJournal = journalToUpdate ? {\n    titre: journalToUpdate.titre,\n    photo: journalToUpdate.photo,\n    data_apparution: journalToUpdate.data_apparution,\n    journal: journalToUpdate.journal,\n    text: journalToUpdate.text\n  } : {\n    titre: \"\",\n    photo: null,\n    data_apparution: today_date,\n    journal: null,\n    text: \"\"\n  };\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  const estValide = (fieldValues = journal) => {\n    const validator = {};\n    if (\"titre\" in fieldValues) validator.titre = journal.titre ? null : \"Le champ titre est obligatoire\"; // if (\"photo\" in fieldValues)\n    //   validator.photo = journal.photo ? null : \"Le champ photo est obligatoire\";\n    // if (\"date_apparution\" in fieldValues)\n    //   validator.date_apparution = journal.date_apparution ? null : \"Le champ date_apparution est obligatoire\";\n    // if (\"journal\" in fieldValues)\n    //   validator.journal = journal.journal\n    //     ? null\n    //     : \"Le champ journal est obligatoire\";\n\n    if (\"text\" in fieldValues) validator.text = journal.text ? null : \"Le champ text est obligatoire\";\n    setErrors({ ...validator\n    }); // retourne boolean si et seulement si on passe un parametre pour la fonction\n\n    if (fieldValues === journal) {\n      return Object.values(validator).every(el => !el);\n    }\n  };\n\n  const {\n    state: journal,\n    setState: setJournal,\n    errors,\n    setErrors,\n    reinitialiserState\n  } = useForm(initialJournal, estValide);\n\n  const handleSubmit = e => {\n    e.preventDefault();\n\n    if (estValide()) {\n      var _journal$journal;\n\n      setIsSending(true); // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n\n      let form_data = new FormData();\n      form_data.append(\"titre\", journal.titre);\n      form_data.append(\"date_publication\", journal.date_apparution);\n      if (journal.photo !== null) form_data.append(\"photo\", journal.photo, journal.photo.name);\n      if (journal.journal !== null) form_data.append(\"journal\", journal.journal, (_journal$journal = journal.journal) === null || _journal$journal === void 0 ? void 0 : _journal$journal.name);\n      form_data.append(\"text\", journal.text);\n      let url = URL + \"journaux/\";\n      axios.post(url, form_data, {\n        headers: {\n          \"content-type\": \"multipart/form-data\"\n        }\n      }).then(res => {\n        setSuccess(true);\n        handleShow();\n        reinitialiserState();\n        setIsSending(false);\n      }).catch(err => {\n        setSuccess(false);\n        handleShow();\n        setIsSending(false);\n      });\n    }\n  };\n\n  const handleUpdate = e => {\n    e.preventDefault();\n\n    if (estValide()) {\n      setIsSending(true); // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n\n      let form_data = new FormData();\n      form_data.append(\"titre\", journal.titre);\n      form_data.append(\"auteur\", journal.auteur);\n      form_data.append(\"date_publication\", journal.date_apparution);\n\n      if (imageUpdated) {\n        var _journal$photo;\n\n        form_data.append(\"photo\", journal.photo, (_journal$photo = journal.photo) === null || _journal$photo === void 0 ? void 0 : _journal$photo.name);\n        setImageUpdated(false);\n      }\n\n      if (journalUpdated) {\n        var _journal$journal2;\n\n        form_data.append(\"journal\", journal.journal, (_journal$journal2 = journal.journal) === null || _journal$journal2 === void 0 ? void 0 : _journal$journal2.name);\n        setJournalUpdated(false);\n      }\n\n      form_data.append(\"text\", journal.text);\n      let url = URL + \"journaux/\" + journalToUpdate.id + \"/\";\n      axios.put(url, form_data, {\n        headers: {\n          \"content-type\": \"multipart/form-data\"\n        }\n      }).then(res => {\n        setSuccess(true);\n        handleShow();\n        reinitialiserState();\n        setIsSending(false);\n      }).catch(err => {\n        setSuccess(false);\n        handleShow();\n        setIsSending(false);\n      });\n    }\n  };\n\n  const hiddenImageInput = useRef(null);\n  const hiddenjournalInput = useRef(null);\n\n  const handleImageClick = event => {\n    hiddenImageInput.current.click();\n  };\n\n  const handlejournalClick = event => {\n    hiddenjournalInput.current.click();\n  };\n\n  const handleImageChange = event => {\n    const fileUploaded = event.target.files[0];\n    setJournal({ ...journal,\n      photo: fileUploaded\n    });\n\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré une image !\");\n      setImageUpdated(true);\n    }\n  };\n\n  const handlejournalChange = event => {\n    const fileUploaded = event.target.files[0];\n    setJournal({ ...journal,\n      journal: fileUploaded\n    });\n\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré un journal !\");\n      setJournalUpdated(true);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.root,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: classes.h2,\n      children: \"Editer un journal\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.flex,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.inputsContainer,\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          id: \"dashboard-outlined-basic\",\n          label: \"Titre\",\n          variant: \"outlined\",\n          value: journal.titre,\n          onChange: e => setJournal({ ...journal,\n            titre: e.target.value\n          }),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errors\",\n          children: errors.titre\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.inputsContainer,\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          id: \"dashboard-outlined-basic\",\n          label: \"Date d'apparution\",\n          type: \"datetime-local\",\n          defaultValue: journalToUpdate ? journalToUpdate.date_apparution : today_date,\n          onChange: e => setJournal({ ...journal,\n            date_apparution: e.target.value\n          }),\n          InputLabelProps: {\n            shrink: true\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errors\",\n          children: errors.data_apparution\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.divTextOverflow,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: \"image d'illustration (*.png)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fullWidth: true,\n          color: \"primary\",\n          variant: \"contained\",\n          className: classes.button,\n          onClick: handleImageClick,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: classes.blueIcon,\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              class: \"fa fa-file-image fa-3x\",\n              \"aria-hidden\": \"true\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 336,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          ref: hiddenImageInput,\n          onChange: handleImageChange,\n          style: {\n            display: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 339,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: [errors.photo, imageUpdated && (journal === null || journal === void 0 ? void 0 : (_journal$photo2 = journal.photo) === null || _journal$photo2 === void 0 ? void 0 : _journal$photo2.name), imageNameToUpdate]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.divTextOverflow,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: \"document compl\\xE9mentaire (*.pdf)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fullWidth: true,\n          color: \"primary\",\n          variant: \"contained\",\n          className: classes.button,\n          onClick: handlejournalClick,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: classes.blueIcon,\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              class: \"fa fa-file-upload fa-3x\",\n              \"aria-hidden\": \"true\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          ref: hiddenjournalInput,\n          onChange: handlejournalChange,\n          style: {\n            display: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: [errors.document, imageUpdated && (journal === null || journal === void 0 ? void 0 : (_journal$document = journal.document) === null || _journal$document === void 0 ? void 0 : _journal$document.name), documentNameToUpdate]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 352,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CKEditor, {\n      editor: ClassicEditor,\n      config: editorConfiguration,\n      data: journalToUpdate ? journalToUpdate.text : \"\",\n      onReady: editor => {\n        // You can store the \"editor\" and use when it is needed.\n        // console.log(\"Editor is ready to use!\", editor);\n        editor === null || editor === void 0 ? void 0 : editor.editing.view.change(writer => {\n          writer.setStyle(\"padding\", \"1.5rem\", editor.editing.view.document.getRoot());\n          writer.setStyle(\"min-height\", \"50vh\", editor.editing.view.document.getRoot());\n        });\n      },\n      onChange: (event, editor) => {\n        setJournal({ ...journal,\n          text: editor.getData()\n        });\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.buttonContainer,\n      children: !journalToUpdate ? /*#__PURE__*/_jsxDEV(Button, {\n        color: \"primary\",\n        variant: \"contained\",\n        onClick: handleSubmit,\n        children: !isSending ? \"Publier\" : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-spinner fa-pulse fa-2x fa-fw\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 17\n          }, this)\n        }, void 0, false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(Button, {\n        color: \"primary\",\n        variant: \"contained\",\n        onClick: handleUpdate,\n        children: !isSending ? \"Modifier\" : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-spinner fa-pulse fa-2x fa-fw\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 424,\n            columnNumber: 17\n          }, this)\n        }, void 0, false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ModalBootsrap, {\n      handleClose: handleClose,\n      show: show,\n      title: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [success ? \"Envoyé\" : \"Oups\", /*#__PURE__*/_jsxDEV(\"i\", {\n          className: `${success ? \" fas fa-thumbs-up\" : \" fas fa-thumbs-down\"}`,\n          style: {\n            color: \"#4caf50\",\n            marginLeft: \"1rem\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 436,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true),\n      children: success ? \"Enregistrement avec succès.\" : \"Une erreur s'est produite, veuillez réessayer.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 293,\n    columnNumber: 5\n  }, this);\n}\n\n_s(JournalFabry, \"y3L/87gKR7Kec8Tcfzr2+nRZ7sk=\", false, function () {\n  return [useStyles, useLocation, useForm];\n});\n\n_c = JournalFabry;\n\nvar _c;\n\n$RefreshReg$(_c, \"JournalFabry\");","map":{"version":3,"sources":["/home/christopher/Documents/Alter/apmfProject/APMF-Front/src/components/admin/journalFabry/JournalFabry.js"],"names":["axios","useState","useRef","URL","extractFilesNames","useForm","TextField","Button","CKEditor","ClassicEditor","makeStyles","ModalBootsrap","useLocation","useStyles","theme","root","minWidth","padding","flex","display","flexDirection","flexWrap","justifyContent","alignItems","margin","inputsContainer","h2","textAlign","button","backgroundColor","border","blueIcon","borderRadius","buttonContainer","marginTop","divTextOverflow","width","whiteSpace","overflow","textOverflow","editorConfiguration","toolbar","items","shouldNotGroupWhenFull","language","image","table","contentToolbar","placeholder","JournalFabry","show","setShow","success","setSuccess","imageUpdated","setImageUpdated","journalUpdated","setJournalUpdated","isSending","setIsSending","classes","location","journalToUpdate","state","imageNameToUpdate","documentNameToUpdate","today_date","Date","toISOString","substr","toLocaleTimeString","hour","minute","initialJournal","titre","photo","data_apparution","journal","text","handleClose","handleShow","estValide","fieldValues","validator","setErrors","Object","values","every","el","setState","setJournal","errors","reinitialiserState","handleSubmit","e","preventDefault","form_data","FormData","append","date_apparution","name","url","post","headers","then","res","catch","err","handleUpdate","auteur","id","put","hiddenImageInput","hiddenjournalInput","handleImageClick","event","current","click","handlejournalClick","handleImageChange","fileUploaded","target","files","handlejournalChange","value","shrink","document","editor","editing","view","change","writer","setStyle","getRoot","getData","color","marginLeft"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { useState, useRef } from \"react\";\nimport { URL } from \"../../../middlewares/request\";\nimport { extractFilesNames } from \"../../../utilities\";\nimport useForm from \"../../../hooks/useForm\";\nimport { TextField, Button } from \"@material-ui/core\";\nimport { CKEditor } from \"@ckeditor/ckeditor5-react\";\nimport ClassicEditor from \"ckeditor5-custom-build/build/ckeditor\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport ModalBootsrap from \"../../modal/Modal\";\nimport { useLocation } from \"react-router-dom\";\n\n//styles des elements html\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    minWidth: \"300px\",\n    padding: \"0 2rem\",\n  },\n  flex: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    margin: \"2rem 0\",\n  },\n  inputsContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    margin: \"0.5rem\",\n  },\n  h2: {\n    textAlign: \"center\",\n  },\n  button: {\n    backgroundColor: \"white\",\n    border: \"2px solid blue\",\n  },\n  blueIcon: {\n    backgroundColor: \"blue\",\n    border: \"2px solid blue\",\n    borderRadius: \"7px\",\n  },\n  buttonContainer: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    marginTop: \"1.5rem\",\n  },\n  divTextOverflow: {\n    width: \"16rem\",\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n  },\n}));\n\n// configuration de l'editeur du texte\nconst editorConfiguration = {\n  toolbar: {\n    items: [\n      \"fontFamily\",\n      \"fontColor\",\n      \"fontBackgroundColor\",\n      \"heading\",\n      \"|\",\n      \"bold\",\n      \"italic\",\n      \"|\",\n      \"alignment:left\",\n      \"alignment:center\",\n      \"alignment:right\",\n      \"alignment:justify\",\n      \"|\",\n      \"underline\",\n      \"highlight\",\n      \"horizontalLine\",\n      \"pageBreak\",\n      \"link\",\n      \"bulletedList\",\n      \"numberedList\",\n      \"|\",\n      \"outdent\",\n      \"indent\",\n      \"|\",\n      \"findAndReplace\",\n      // \"imageUpload\",\n      // \"imageInsert\",\n      \"blockQuote\",\n      \"insertTable\",\n      // \"mediaEmbed\",\n      \"undo\",\n      \"redo\",\n    ],\n    shouldNotGroupWhenFull: true,\n  },\n  language: \"fr\",\n  image: {\n    toolbar: [\n      \"imageTextAlternative\",\n      \"imageStyle:full\",\n      \"imageStyle:side\",\n      \"linkImage\",\n    ],\n  },\n  table: {\n    contentToolbar: [\"tableColumn\", \"tableRow\", \"mergeTableCells\"],\n  },\n  placeholder: \"Entrer votre texte ici...\",\n};\n\nexport default function JournalFabry() {\n  const [show, setShow] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [imageUpdated, setImageUpdated] = useState(false);\n  const [journalUpdated, setJournalUpdated] = useState(false);\n\n  const [isSending, setIsSending] = useState(false);\n\n  const classes = useStyles();\n  const location = useLocation();\n  const journalToUpdate = location.state?.journalToUpdate;\n\n  const { imageNameToUpdate, documentNameToUpdate } =\n    extractFilesNames(journalToUpdate);\n\n  //pour la defaultValue de date d'apparution\n  const today_date = `${new Date()\n    .toISOString()\n    .substr(0, 10)}T${new Date().toLocaleTimeString([], {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  })}`;\n\n  const initialJournal = journalToUpdate\n    ? {\n        titre: journalToUpdate.titre,\n        photo: journalToUpdate.photo,\n        data_apparution: journalToUpdate.data_apparution,\n        journal: journalToUpdate.journal,\n        text: journalToUpdate.text,\n      }\n    : {\n        titre: \"\",\n        photo: null,\n        data_apparution: today_date,\n        journal: null,\n        text: \"\",\n      };\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  const estValide = (fieldValues = journal) => {\n    const validator = {};\n\n    if (\"titre\" in fieldValues)\n      validator.titre = journal.titre ? null : \"Le champ titre est obligatoire\";\n\n    // if (\"photo\" in fieldValues)\n    //   validator.photo = journal.photo ? null : \"Le champ photo est obligatoire\";\n\n    // if (\"date_apparution\" in fieldValues)\n    //   validator.date_apparution = journal.date_apparution ? null : \"Le champ date_apparution est obligatoire\";\n\n    // if (\"journal\" in fieldValues)\n    //   validator.journal = journal.journal\n    //     ? null\n    //     : \"Le champ journal est obligatoire\";\n\n    if (\"text\" in fieldValues)\n      validator.text = journal.text ? null : \"Le champ text est obligatoire\";\n\n    setErrors({ ...validator });\n\n    // retourne boolean si et seulement si on passe un parametre pour la fonction\n    if (fieldValues === journal) {\n      return Object.values(validator).every((el) => !el);\n    }\n  };\n\n  const {\n    state: journal,\n    setState: setJournal,\n    errors,\n    setErrors,\n    reinitialiserState,\n  } = useForm(initialJournal, estValide);\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (estValide()) {\n      setIsSending(true);\n      // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n      let form_data = new FormData();\n      form_data.append(\"titre\", journal.titre);\n      form_data.append(\"date_publication\", journal.date_apparution);\n      if (journal.photo !== null)\n        form_data.append(\"photo\", journal.photo, journal.photo.name);\n      if (journal.journal !== null)\n        form_data.append(\"journal\", journal.journal, journal.journal?.name);\n      form_data.append(\"text\", journal.text);\n      let url = URL + \"journaux/\";\n\n      axios\n        .post(url, form_data, {\n          headers: {\n            \"content-type\": \"multipart/form-data\",\n          },\n        })\n        .then((res) => {\n          setSuccess(true);\n          handleShow();\n          reinitialiserState();\n          setIsSending(false);\n        })\n        .catch((err) => {\n          setSuccess(false);\n          handleShow();\n          setIsSending(false);\n        });\n    }\n  };\n\n  const handleUpdate = (e) => {\n    e.preventDefault();\n    if (estValide()) {\n      setIsSending(true);\n      // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n      let form_data = new FormData();\n      form_data.append(\"titre\", journal.titre);\n      form_data.append(\"auteur\", journal.auteur);\n      form_data.append(\"date_publication\", journal.date_apparution);\n      if (imageUpdated) {\n        form_data.append(\"photo\", journal.photo, journal.photo?.name);\n        setImageUpdated(false);\n      }\n      if (journalUpdated) {\n        form_data.append(\"journal\", journal.journal, journal.journal?.name);\n        setJournalUpdated(false);\n      }\n      form_data.append(\"text\", journal.text);\n      let url = URL + \"journaux/\" + journalToUpdate.id + \"/\";\n\n      axios\n        .put(url, form_data, {\n          headers: {\n            \"content-type\": \"multipart/form-data\",\n          },\n        })\n        .then((res) => {\n          setSuccess(true);\n          handleShow();\n          reinitialiserState();\n          setIsSending(false);\n        })\n        .catch((err) => {\n          setSuccess(false);\n          handleShow();\n          setIsSending(false);\n        });\n    }\n  };\n\n  const hiddenImageInput = useRef(null);\n  const hiddenjournalInput = useRef(null);\n\n  const handleImageClick = (event) => {\n    hiddenImageInput.current.click();\n  };\n\n  const handlejournalClick = (event) => {\n    hiddenjournalInput.current.click();\n  };\n\n  const handleImageChange = (event) => {\n    const fileUploaded = event.target.files[0];\n    setJournal({ ...journal, photo: fileUploaded });\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré une image !\");\n      setImageUpdated(true);\n    }\n  };\n\n  const handlejournalChange = (event) => {\n    const fileUploaded = event.target.files[0];\n    setJournal({ ...journal, journal: fileUploaded });\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré un journal !\");\n      setJournalUpdated(true);\n    }\n  };\n\n  return (\n    <div className={classes.root}>\n      <h2 className={classes.h2}>Editer un journal</h2>\n      <div className={classes.flex}>\n        <div className={classes.inputsContainer}>\n          <TextField\n            id=\"dashboard-outlined-basic\"\n            label=\"Titre\"\n            variant=\"outlined\"\n            value={journal.titre}\n            onChange={(e) => setJournal({ ...journal, titre: e.target.value })}\n            required\n          />\n          <div className=\"errors\">{errors.titre}</div>\n        </div>\n        <div className={classes.inputsContainer}>\n          <TextField\n            id=\"dashboard-outlined-basic\"\n            label=\"Date d'apparution\"\n            type=\"datetime-local\"\n            defaultValue={\n              journalToUpdate ? journalToUpdate.date_apparution : today_date\n            }\n            onChange={(e) =>\n              setJournal({ ...journal, date_apparution: e.target.value })\n            }\n            InputLabelProps={{\n              shrink: true,\n            }}\n          />\n          <div className=\"errors\">{errors.data_apparution}</div>\n        </div>\n        <div className={classes.divTextOverflow}>\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            image d'illustration (*.png)\n          </p>\n          <Button\n            fullWidth\n            color=\"primary\"\n            variant=\"contained\"\n            className={classes.button}\n            onClick={handleImageClick}\n          >\n            <span className={classes.blueIcon}>\n              <i class=\"fa fa-file-image fa-3x\" aria-hidden=\"true\"></i>\n            </span>\n          </Button>\n          <input\n            type=\"file\"\n            ref={hiddenImageInput}\n            onChange={handleImageChange}\n            style={{ display: \"none\" }}\n          />\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            {errors.photo}\n            {imageUpdated && journal?.photo?.name}\n            {imageNameToUpdate}\n          </p>\n        </div>\n\n        <div className={classes.divTextOverflow}>\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            document complémentaire (*.pdf)\n          </p>\n          <Button\n            fullWidth\n            color=\"primary\"\n            variant=\"contained\"\n            className={classes.button}\n            onClick={handlejournalClick}\n          >\n            <span className={classes.blueIcon}>\n              <i class=\"fa fa-file-upload fa-3x\" aria-hidden=\"true\"></i>\n            </span>\n          </Button>\n          <input\n            type=\"file\"\n            ref={hiddenjournalInput}\n            onChange={handlejournalChange}\n            style={{ display: \"none\" }}\n          />\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            {errors.document}\n            {imageUpdated && journal?.document?.name}\n            {documentNameToUpdate}\n          </p>\n        </div>\n      </div>\n      <CKEditor\n        editor={ClassicEditor}\n        config={editorConfiguration}\n        data={journalToUpdate ? journalToUpdate.text : \"\"}\n        onReady={(editor) => {\n          // You can store the \"editor\" and use when it is needed.\n          // console.log(\"Editor is ready to use!\", editor);\n          editor?.editing.view.change((writer) => {\n            writer.setStyle(\n              \"padding\",\n              \"1.5rem\",\n              editor.editing.view.document.getRoot()\n            );\n            writer.setStyle(\n              \"min-height\",\n              \"50vh\",\n              editor.editing.view.document.getRoot()\n            );\n          });\n        }}\n        onChange={(event, editor) => {\n          setJournal({\n            ...journal,\n            text: editor.getData(),\n          });\n        }}\n      />\n      <div className={classes.buttonContainer}>\n        {!journalToUpdate ? (\n          <Button color=\"primary\" variant=\"contained\" onClick={handleSubmit}>\n            {!isSending ? (\n              \"Publier\"\n            ) : (\n              <>\n                <i className=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i>\n              </>\n            )}\n          </Button>\n        ) : (\n          <Button color=\"primary\" variant=\"contained\" onClick={handleUpdate}>\n            {!isSending ? (\n              \"Modifier\"\n            ) : (\n              <>\n                <i className=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i>\n              </>\n            )}\n          </Button>\n        )}\n      </div>\n      <ModalBootsrap\n        handleClose={handleClose}\n        show={show}\n        title={\n          <>\n            {success ? \"Envoyé\" : \"Oups\"}\n            <i\n              className={`${\n                success ? \" fas fa-thumbs-up\" : \" fas fa-thumbs-down\"\n              }`}\n              style={{ color: \"#4caf50\", marginLeft: \"1rem\" }}\n            ></i>\n          </>\n        }\n      >\n        {success\n          ? \"Enregistrement avec succès.\"\n          : \"Une erreur s'est produite, veuillez réessayer.\"}\n      </ModalBootsrap>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}