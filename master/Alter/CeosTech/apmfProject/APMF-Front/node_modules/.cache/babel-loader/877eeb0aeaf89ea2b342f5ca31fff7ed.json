{"ast":null,"code":"var _jsxFileName = \"/home/christopher/Documents/Alter/apmfProject/APMF-Front/src/components/admin/editerArticle/EditerArticle.js\",\n    _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport { useState, useRef } from \"react\";\nimport { URL } from \"../../../middlewares/request\";\nimport { extractFilesNames } from \"../../../utilities\";\nimport useForm from \"../../../hooks/useForm\";\nimport { TextField, Button } from \"@material-ui/core\";\nimport { CKEditor } from \"@ckeditor/ckeditor5-react\";\nimport ClassicEditor from \"ckeditor5-custom-build/build/ckeditor\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport ModalBootsrap from \"../../modal/Modal\";\nimport { useLocation } from \"react-router-dom\"; //styles des elements html\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  root: {\n    minWidth: \"300px\",\n    padding: \"0 2rem\"\n  },\n  flex: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    margin: \"1rem 0\"\n  },\n  inputsContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    margin: \"1rem 0\"\n  },\n  h2: {\n    textAlign: \"center\"\n  },\n  button: {\n    backgroundColor: \"white\",\n    border: \"2px solid blue\"\n  },\n  blueIcon: {\n    backgroundColor: \"blue\",\n    border: \"2px solid blue\",\n    borderRadius: \"7px\"\n  },\n  buttonContainer: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    marginTop: \"1.5rem\"\n  },\n  divTextOverflow: {\n    Width: \"16rem\",\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\"\n  }\n})); // configuration de l'editeur du texte\n\nconst editorConfiguration = {\n  toolbar: {\n    items: [\"fontFamily\", \"fontColor\", \"fontBackgroundColor\", \"heading\", \"|\", \"bold\", \"italic\", \"underline\", \"|\", \"alignment:left\", \"alignment:center\", \"alignment:right\", \"alignment:justify\", \"|\", \"underline\", \"highlight\", \"horizontalLine\", \"pageBreak\", \"link\", \"bulletedList\", \"numberedList\", \"|\", \"outdent\", \"indent\", \"|\", \"findAndReplace\", // \"imageUpload\",\n    // \"imageInsert\",\n    \"blockQuote\", \"insertTable\", // \"mediaEmbed\",\n    \"undo\", \"redo\"],\n    shouldNotGroupWhenFull: true\n  },\n  language: \"fr\",\n  image: {\n    toolbar: [\"imageTextAlternative\", \"imageStyle:full\", \"imageStyle:side\", \"linkImage\"]\n  },\n  table: {\n    contentToolbar: [\"tableColumn\", \"tableRow\", \"mergeTableCells\", \"tableProperties\", \"tableCellProperties\"]\n  },\n  placeholder: \"Entrer votre texte ici...\"\n};\nexport default function EditerArticle() {\n  _s();\n\n  var _location$state, _article$photo, _article$document;\n\n  const [show, setShow] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [imageUpdated, setImageUpdated] = useState(false);\n  const [documentUpdated, setDocumentUpdated] = useState(false);\n  const [isSending, setIsSending] = useState(false);\n  const classes = useStyles();\n  const location = useLocation();\n  const articleToUpdate = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.articleToUpdate;\n  const {\n    imageNameToUpdate,\n    documentNameToUpdate\n  } = extractFilesNames(articleToUpdate); //pour la defaultValue de date d'apparution\n\n  const today_date = `${new Date().toISOString().substr(0, 10)}T${new Date().toLocaleTimeString([], {\n    hour: \"2-digit\",\n    minute: \"2-digit\"\n  })}`;\n  const initialArticle = articleToUpdate ? {\n    titre: articleToUpdate.titre,\n    auteur: articleToUpdate.auteur,\n    data_apparution: articleToUpdate.data_apparution,\n    description: articleToUpdate.description,\n    photo: articleToUpdate.photo,\n    document: articleToUpdate.document,\n    text: articleToUpdate.text\n  } : {\n    titre: \"\",\n    auteur: \"\",\n    date_apparution: today_date,\n    description: \"\",\n    photo: null,\n    document: null,\n    text: \"\"\n  };\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  const estValide = (fieldValues = article) => {\n    const validator = {};\n    if (\"titre\" in fieldValues) validator.titre = article.titre ? null : \"Le champ titre est obligatoire\";\n    if (\"auteur\" in fieldValues) validator.auteur = article.auteur ? null : \"Le champ auteur est obligatoire\";\n    if (\"description\" in fieldValues) validator.description = article.description ? null : \"Le champ description est obligatoire\"; // if (\"date_apparution\" in fieldValues)\n    //   validator.date_apparution = article.date_apparution\n    //     ? null\n    //     : \"Le champ date apparution est obligatoire\";\n    // if (\"photo\" in fieldValues)\n    //   validator.photo = article.photo ? null : \"Le champ photo est obligatoire\";\n    // if (\"document\" in fieldValues)\n    //   validator.document = article.document ? null : \"Le champ document est obligatoire\";\n\n    if (\"text\" in fieldValues) validator.text = article.text ? null : \"Le champ text est obligatoire\";\n    setErrors({ ...validator\n    }); // retourne boolean si et seulement si on passe un parametre pour la fonction\n\n    if (fieldValues === article) {\n      return Object.values(validator).every(el => !el);\n    }\n  };\n\n  const {\n    state: article,\n    setState: setArticle,\n    errors,\n    setErrors,\n    reinitialiserState\n  } = useForm(initialArticle, estValide);\n\n  const handleSubmit = e => {\n    estValide();\n    e.preventDefault();\n\n    if (estValide()) {\n      setIsSending(true); // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n\n      let form_data = new FormData();\n      form_data.append(\"titre\", article.titre);\n      form_data.append(\"auteur\", article.auteur);\n      form_data.append(\"date_publication\", article.date_apparution);\n      form_data.append(\"description\", article.description);\n      if (article.photo !== null) form_data.append(\"photo\", article.photo, article.photo.name);\n      if (article.document !== null) form_data.append(\"document\", article.document, article.document.name);\n      form_data.append(\"text\", article.text);\n      let url = URL + \"articles/\";\n      axios.post(url, form_data, {\n        headers: {\n          \"content-type\": \"multipart/form-data\"\n        }\n      }).then(res => {\n        setSuccess(true);\n        handleShow();\n        reinitialiserState();\n        setIsSending(false);\n      }).catch(err => {\n        setSuccess(false);\n        handleShow();\n        setIsSending(false);\n      });\n    }\n  };\n\n  const handleUpdate = e => {\n    e.preventDefault();\n\n    if (estValide()) {\n      setIsSending(true); // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n\n      let form_data = new FormData();\n      form_data.append(\"titre\", article.titre);\n      form_data.append(\"auteur\", article.auteur);\n      form_data.append(\"date_publication\", article.date_apparution);\n      form_data.append(\"description\", article.description);\n\n      if (imageUpdated) {\n        form_data.append(\"photo\", article.photo, article.photo.name);\n        setImageUpdated(false);\n      }\n\n      if (documentUpdated) {\n        form_data.append(\"document\", article.document, article.document.name);\n        setDocumentUpdated(false);\n      }\n\n      form_data.append(\"text\", article.text);\n      let url = URL + \"articles/\" + articleToUpdate.id + \"/\";\n      axios.put(url, form_data, {\n        headers: {\n          \"content-type\": \"multipart/form-data\"\n        }\n      }).then(res => {\n        setSuccess(true);\n        handleShow();\n        reinitialiserState();\n        setIsSending(false);\n      }).catch(err => {\n        setSuccess(false);\n        handleShow();\n        setIsSending(false);\n      });\n    }\n  };\n\n  const hiddenImageInput = useRef(null);\n  const hiddenDocumentInput = useRef(null);\n\n  const handleImageClick = event => {\n    hiddenImageInput.current.click();\n  };\n\n  const handleDocumentClick = event => {\n    hiddenDocumentInput.current.click();\n  };\n\n  const handleImageChange = event => {\n    const fileUploaded = event.target.files[0];\n    setArticle({ ...article,\n      photo: fileUploaded\n    });\n\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré une image !\");\n      setImageUpdated(true);\n    }\n  };\n\n  const handleDocumentChange = event => {\n    const fileUploaded = event.target.files[0];\n    setArticle({ ...article,\n      document: fileUploaded\n    });\n\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré un document !\");\n      setDocumentUpdated(true);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.root,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: classes.h2,\n      children: \"Editer un article\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.flex,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.inputsContainer,\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          id: \"dashboard-outlined-basic\",\n          label: \"Titre\",\n          variant: \"outlined\",\n          value: article.titre,\n          onChange: e => setArticle({ ...article,\n            titre: e.target.value\n          }),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errors\",\n          children: errors.titre\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.inputsContainer,\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          id: \"dashboard-outlined-basic\",\n          label: \"Auteur\",\n          variant: \"outlined\",\n          value: article.auteur,\n          onChange: e => setArticle({ ...article,\n            auteur: e.target.value\n          }),\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errors\",\n          children: errors.auteur\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.inputsContainer,\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          id: \"dashboard-outlined-basic\",\n          label: \"Date d'apparution\",\n          type: \"datetime-local\",\n          defaultValue: articleToUpdate ? articleToUpdate.date_apparution : today_date,\n          onChange: e => setArticle({ ...article,\n            date_apparution: e.target.value\n          }),\n          InputLabelProps: {\n            shrink: true\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errors\",\n          children: errors.data_apparution\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        flexWrap: \"wrap\",\n        justifyContent: \"space-around\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.divTextOverflow,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: \"image d'illustration (*.png)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fullWidth: true,\n          color: \"primary\",\n          variant: \"contained\",\n          className: classes.button,\n          onClick: handleImageClick,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: classes.blueIcon,\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fa fa-file-image fa-3x\",\n              \"aria-hidden\": \"true\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          ref: hiddenImageInput,\n          onChange: handleImageChange,\n          style: {\n            display: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: [errors.photo, imageUpdated && (article === null || article === void 0 ? void 0 : (_article$photo = article.photo) === null || _article$photo === void 0 ? void 0 : _article$photo.name), imageNameToUpdate]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.divTextOverflow,\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: \"document compl\\xE9mentaire (*.pdf)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          fullWidth: true,\n          color: \"primary\",\n          variant: \"contained\",\n          className: classes.button,\n          onClick: handleDocumentClick,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: classes.blueIcon,\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fa fa-file-upload fa-3x\",\n              \"aria-hidden\": \"true\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 414,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          ref: hiddenDocumentInput,\n          onChange: handleDocumentChange,\n          style: {\n            display: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            width: \"100%\",\n            textAlign: \"center\"\n          },\n          children: [errors.document, imageUpdated && (article === null || article === void 0 ? void 0 : (_article$document = article.document) === null || _article$document === void 0 ? void 0 : _article$document.name), documentNameToUpdate]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 423,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        flexDirection: \"column\",\n        margin: \"2rem 0\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(TextField, {\n        multiline: true,\n        rows: 2,\n        label: \"Description\",\n        variant: \"outlined\",\n        value: article.description,\n        onChange: e => setArticle({ ...article,\n          description: e.target.value\n        }),\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"errors\",\n        children: errors.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CKEditor, {\n      editor: ClassicEditor,\n      config: editorConfiguration,\n      data: articleToUpdate ? articleToUpdate.text : \"\",\n      onReady: editor => {\n        editor === null || editor === void 0 ? void 0 : editor.editing.view.change(writer => {\n          writer.setStyle(\"padding\", \"1.5rem\", editor.editing.view.document.getRoot());\n          writer.setStyle(\"min-height\", \"22vh\", editor.editing.view.document.getRoot());\n        });\n      },\n      onChange: (event, editor) => {\n        setArticle({ ...article,\n          text: editor.getData()\n        });\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.buttonContainer,\n      children: !articleToUpdate ? /*#__PURE__*/_jsxDEV(Button, {\n        color: \"primary\",\n        variant: \"contained\",\n        onClick: handleSubmit,\n        children: !isSending ? \"Publier\" : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-spinner fa-pulse fa-2x fa-fw\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 478,\n            columnNumber: 17\n          }, this)\n        }, void 0, false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(Button, {\n        color: \"primary\",\n        variant: \"contained\",\n        onClick: handleUpdate,\n        children: !isSending ? \"Modifier\" : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-spinner fa-pulse fa-2x fa-fw\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 17\n          }, this)\n        }, void 0, false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ModalBootsrap, {\n      handleClose: handleClose,\n      show: show,\n      title: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [success ? \"Envoyé\" : \"Oups\", /*#__PURE__*/_jsxDEV(\"i\", {\n          className: `${success ? \" fas fa-thumbs-up\" : \" fas fa-thumbs-down\"}`,\n          style: {\n            color: \"#4caf50\",\n            marginLeft: \"1rem\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 500,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true),\n      children: success ? \"Enregistrement avec succès.\" : \"Une erreur s'est produite, veuillez réessayer.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 494,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 318,\n    columnNumber: 5\n  }, this);\n}\n\n_s(EditerArticle, \"Fon9FNEfmmshlh+rKVlyMcuWfA0=\", false, function () {\n  return [useStyles, useLocation, useForm];\n});\n\n_c = EditerArticle;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditerArticle\");","map":{"version":3,"sources":["/home/christopher/Documents/Alter/apmfProject/APMF-Front/src/components/admin/editerArticle/EditerArticle.js"],"names":["axios","useState","useRef","URL","extractFilesNames","useForm","TextField","Button","CKEditor","ClassicEditor","makeStyles","ModalBootsrap","useLocation","useStyles","theme","root","minWidth","padding","flex","display","flexWrap","justifyContent","alignItems","margin","inputsContainer","flexDirection","h2","textAlign","button","backgroundColor","border","blueIcon","borderRadius","buttonContainer","marginTop","divTextOverflow","Width","whiteSpace","overflow","textOverflow","editorConfiguration","toolbar","items","shouldNotGroupWhenFull","language","image","table","contentToolbar","placeholder","EditerArticle","show","setShow","success","setSuccess","imageUpdated","setImageUpdated","documentUpdated","setDocumentUpdated","isSending","setIsSending","classes","location","articleToUpdate","state","imageNameToUpdate","documentNameToUpdate","today_date","Date","toISOString","substr","toLocaleTimeString","hour","minute","initialArticle","titre","auteur","data_apparution","description","photo","document","text","date_apparution","handleClose","handleShow","estValide","fieldValues","article","validator","setErrors","Object","values","every","el","setState","setArticle","errors","reinitialiserState","handleSubmit","e","preventDefault","form_data","FormData","append","name","url","post","headers","then","res","catch","err","handleUpdate","id","put","hiddenImageInput","hiddenDocumentInput","handleImageClick","event","current","click","handleDocumentClick","handleImageChange","fileUploaded","target","files","handleDocumentChange","value","shrink","width","editor","editing","view","change","writer","setStyle","getRoot","getData","color","marginLeft"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { useState, useRef } from \"react\";\nimport { URL } from \"../../../middlewares/request\";\nimport { extractFilesNames } from \"../../../utilities\";\nimport useForm from \"../../../hooks/useForm\";\nimport { TextField, Button } from \"@material-ui/core\";\nimport { CKEditor } from \"@ckeditor/ckeditor5-react\";\nimport ClassicEditor from \"ckeditor5-custom-build/build/ckeditor\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport ModalBootsrap from \"../../modal/Modal\";\nimport { useLocation } from \"react-router-dom\";\n\n//styles des elements html\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    minWidth: \"300px\",\n    padding: \"0 2rem\",\n  },\n  flex: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    margin: \"1rem 0\",\n  },\n  inputsContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    margin: \"1rem 0\",\n  },\n  h2: {\n    textAlign: \"center\",\n  },\n  button: {\n    backgroundColor: \"white\",\n    border: \"2px solid blue\",\n  },\n  blueIcon: {\n    backgroundColor: \"blue\",\n    border: \"2px solid blue\",\n    borderRadius: \"7px\",\n  },\n  buttonContainer: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    marginTop: \"1.5rem\",\n  },\n  divTextOverflow: {\n    Width: \"16rem\",\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n  },\n}));\n\n// configuration de l'editeur du texte\nconst editorConfiguration = {\n  toolbar: {\n    items: [\n      \"fontFamily\",\n      \"fontColor\",\n      \"fontBackgroundColor\",\n      \"heading\",\n      \"|\",\n      \"bold\",\n      \"italic\",\n      \"underline\",\n      \"|\",\n      \"alignment:left\",\n      \"alignment:center\",\n      \"alignment:right\",\n      \"alignment:justify\",\n      \"|\",\n      \"underline\",\n      \"highlight\",\n      \"horizontalLine\",\n      \"pageBreak\",\n      \"link\",\n      \"bulletedList\",\n      \"numberedList\",\n      \"|\",\n      \"outdent\",\n      \"indent\",\n      \"|\",\n      \"findAndReplace\",\n      // \"imageUpload\",\n      // \"imageInsert\",\n      \"blockQuote\",\n      \"insertTable\",\n      // \"mediaEmbed\",\n      \"undo\",\n      \"redo\",\n    ],\n    shouldNotGroupWhenFull: true,\n  },\n  language: \"fr\",\n  image: {\n    toolbar: [\n      \"imageTextAlternative\",\n      \"imageStyle:full\",\n      \"imageStyle:side\",\n      \"linkImage\",\n    ],\n  },\n  table: {\n    contentToolbar: [\n      \"tableColumn\",\n      \"tableRow\",\n      \"mergeTableCells\",\n      \"tableProperties\",\n      \"tableCellProperties\",\n    ],\n  },\n  placeholder: \"Entrer votre texte ici...\",\n};\n\nexport default function EditerArticle() {\n  const [show, setShow] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [imageUpdated, setImageUpdated] = useState(false);\n  const [documentUpdated, setDocumentUpdated] = useState(false);\n\n  const [isSending, setIsSending] = useState(false);\n\n  const classes = useStyles();\n  const location = useLocation();\n  const articleToUpdate = location.state?.articleToUpdate;\n\n  const { imageNameToUpdate, documentNameToUpdate } =\n    extractFilesNames(articleToUpdate);\n\n  //pour la defaultValue de date d'apparution\n  const today_date = `${new Date()\n    .toISOString()\n    .substr(0, 10)}T${new Date().toLocaleTimeString([], {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  })}`;\n\n  const initialArticle = articleToUpdate\n    ? {\n        titre: articleToUpdate.titre,\n        auteur: articleToUpdate.auteur,\n        data_apparution: articleToUpdate.data_apparution,\n        description: articleToUpdate.description,\n        photo: articleToUpdate.photo,\n        document: articleToUpdate.document,\n        text: articleToUpdate.text,\n      }\n    : {\n        titre: \"\",\n        auteur: \"\",\n        date_apparution: today_date,\n        description: \"\",\n        photo: null,\n        document: null,\n        text: \"\",\n      };\n\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  const estValide = (fieldValues = article) => {\n    const validator = {};\n\n    if (\"titre\" in fieldValues)\n      validator.titre = article.titre ? null : \"Le champ titre est obligatoire\";\n\n    if (\"auteur\" in fieldValues)\n      validator.auteur = article.auteur\n        ? null\n        : \"Le champ auteur est obligatoire\";\n\n    if (\"description\" in fieldValues)\n      validator.description = article.description\n        ? null\n        : \"Le champ description est obligatoire\";\n\n    // if (\"date_apparution\" in fieldValues)\n    //   validator.date_apparution = article.date_apparution\n    //     ? null\n    //     : \"Le champ date apparution est obligatoire\";\n\n    // if (\"photo\" in fieldValues)\n    //   validator.photo = article.photo ? null : \"Le champ photo est obligatoire\";\n\n    // if (\"document\" in fieldValues)\n    //   validator.document = article.document ? null : \"Le champ document est obligatoire\";\n\n    if (\"text\" in fieldValues)\n      validator.text = article.text ? null : \"Le champ text est obligatoire\";\n\n    setErrors({ ...validator });\n\n    // retourne boolean si et seulement si on passe un parametre pour la fonction\n    if (fieldValues === article) {\n      return Object.values(validator).every((el) => !el);\n    }\n  };\n\n  const {\n    state: article,\n    setState: setArticle,\n    errors,\n    setErrors,\n    reinitialiserState,\n  } = useForm(initialArticle, estValide);\n\n  const handleSubmit = (e) => {\n    estValide();\n    e.preventDefault();\n    if (estValide()) {\n      setIsSending(true);\n      // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n      let form_data = new FormData();\n      form_data.append(\"titre\", article.titre);\n      form_data.append(\"auteur\", article.auteur);\n      form_data.append(\"date_publication\", article.date_apparution);\n      form_data.append(\"description\", article.description);\n      if (article.photo !== null)\n        form_data.append(\"photo\", article.photo, article.photo.name);\n      if (article.document !== null)\n        form_data.append(\"document\", article.document, article.document.name);\n      form_data.append(\"text\", article.text);\n      let url = URL + \"articles/\";\n\n      axios\n        .post(url, form_data, {\n          headers: {\n            \"content-type\": \"multipart/form-data\",\n          },\n        })\n        .then((res) => {\n          setSuccess(true);\n          handleShow();\n          reinitialiserState();\n          setIsSending(false);\n        })\n        .catch((err) => {\n          setSuccess(false);\n          handleShow();\n          setIsSending(false);\n        });\n    }\n  };\n\n  const handleUpdate = (e) => {\n    e.preventDefault();\n    if (estValide()) {\n      setIsSending(true);\n      // On utilise FormData pour envoyer un fichier vers l'api, car avec sendresquest cela ne fonctionne pas vu que ça envoie un\n      let form_data = new FormData();\n      form_data.append(\"titre\", article.titre);\n      form_data.append(\"auteur\", article.auteur);\n      form_data.append(\"date_publication\", article.date_apparution);\n      form_data.append(\"description\", article.description);\n      if (imageUpdated) {\n        form_data.append(\"photo\", article.photo, article.photo.name);\n        setImageUpdated(false);\n      }\n      if (documentUpdated) {\n        form_data.append(\"document\", article.document, article.document.name);\n        setDocumentUpdated(false);\n      }\n      form_data.append(\"text\", article.text);\n      let url = URL + \"articles/\" + articleToUpdate.id + \"/\";\n\n      axios\n        .put(url, form_data, {\n          headers: {\n            \"content-type\": \"multipart/form-data\",\n          },\n        })\n        .then((res) => {\n          setSuccess(true);\n          handleShow();\n          reinitialiserState();\n          setIsSending(false);\n        })\n        .catch((err) => {\n          setSuccess(false);\n          handleShow();\n          setIsSending(false);\n        });\n    }\n  };\n\n  const hiddenImageInput = useRef(null);\n  const hiddenDocumentInput = useRef(null);\n\n  const handleImageClick = (event) => {\n    hiddenImageInput.current.click();\n  };\n\n  const handleDocumentClick = (event) => {\n    hiddenDocumentInput.current.click();\n  };\n\n  const handleImageChange = (event) => {\n    const fileUploaded = event.target.files[0];\n    setArticle({ ...article, photo: fileUploaded });\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré une image !\");\n      setImageUpdated(true);\n    }\n  };\n\n  const handleDocumentChange = (event) => {\n    const fileUploaded = event.target.files[0];\n    setArticle({ ...article, document: fileUploaded });\n    if (fileUploaded) {\n      // alert(\"Vous avez inséré un document !\");\n      setDocumentUpdated(true);\n    }\n  };\n\n  return (\n    <div className={classes.root}>\n      <h2 className={classes.h2}>Editer un article</h2>\n      <div className={classes.flex}>\n        <div className={classes.inputsContainer}>\n          <TextField\n            id=\"dashboard-outlined-basic\"\n            label=\"Titre\"\n            variant=\"outlined\"\n            value={article.titre}\n            onChange={(e) => setArticle({ ...article, titre: e.target.value })}\n            required\n          />\n          <div className=\"errors\">{errors.titre}</div>\n        </div>\n        <div className={classes.inputsContainer}>\n          <TextField\n            id=\"dashboard-outlined-basic\"\n            label=\"Auteur\"\n            variant=\"outlined\"\n            value={article.auteur}\n            onChange={(e) => setArticle({ ...article, auteur: e.target.value })}\n            required\n          />\n          <div className=\"errors\">{errors.auteur}</div>\n        </div>\n        <div className={classes.inputsContainer}>\n          <TextField\n            id=\"dashboard-outlined-basic\"\n            label=\"Date d'apparution\"\n            type=\"datetime-local\"\n            defaultValue={\n              articleToUpdate ? articleToUpdate.date_apparution : today_date\n            }\n            onChange={(e) =>\n              setArticle({ ...article, date_apparution: e.target.value })\n            }\n            InputLabelProps={{\n              shrink: true,\n            }}\n          />\n          <div className=\"errors\">{errors.data_apparution}</div>\n        </div>\n      </div>\n      <div\n        style={{\n          display: \"flex\",\n          flexWrap: \"wrap\",\n          justifyContent: \"space-around\",\n        }}\n      >\n        <div className={classes.divTextOverflow}>\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            image d'illustration (*.png)\n          </p>\n          <Button\n            fullWidth\n            color=\"primary\"\n            variant=\"contained\"\n            className={classes.button}\n            onClick={handleImageClick}\n          >\n            <span className={classes.blueIcon}>\n              <i className=\"fa fa-file-image fa-3x\" aria-hidden=\"true\"></i>\n            </span>\n          </Button>\n\n          <input\n            type=\"file\"\n            ref={hiddenImageInput}\n            onChange={handleImageChange}\n            style={{ display: \"none\" }}\n          />\n          <p\n            style={{\n              width: \"100%\",\n              textAlign: \"center\",\n            }}\n          >\n            {errors.photo}\n            {imageUpdated && article?.photo?.name}\n            {imageNameToUpdate}\n          </p>\n        </div>\n\n        <div className={classes.divTextOverflow}>\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            document complémentaire (*.pdf)\n          </p>\n          <Button\n            fullWidth\n            color=\"primary\"\n            variant=\"contained\"\n            className={classes.button}\n            onClick={handleDocumentClick}\n          >\n            <span className={classes.blueIcon}>\n              <i className=\"fa fa-file-upload fa-3x\" aria-hidden=\"true\"></i>\n            </span>\n          </Button>\n          <input\n            type=\"file\"\n            ref={hiddenDocumentInput}\n            onChange={handleDocumentChange}\n            style={{ display: \"none\" }}\n          />\n          <p style={{ width: \"100%\", textAlign: \"center\" }}>\n            {errors.document}\n            {imageUpdated && article?.document?.name}\n            {documentNameToUpdate}\n          </p>\n        </div>\n      </div>\n      <div\n        style={{ display: \"flex\", flexDirection: \"column\", margin: \"2rem 0\" }}\n      >\n        <TextField\n          multiline\n          rows={2}\n          label=\"Description\"\n          variant=\"outlined\"\n          value={article.description}\n          onChange={(e) =>\n            setArticle({ ...article, description: e.target.value })\n          }\n          required\n        />\n        <div className=\"errors\">{errors.description}</div>\n      </div>\n      <CKEditor\n        editor={ClassicEditor}\n        config={editorConfiguration}\n        data={articleToUpdate ? articleToUpdate.text : \"\"}\n        onReady={(editor) => {\n          editor?.editing.view.change((writer) => {\n            writer.setStyle(\n              \"padding\",\n              \"1.5rem\",\n              editor.editing.view.document.getRoot()\n            );\n            writer.setStyle(\n              \"min-height\",\n              \"22vh\",\n              editor.editing.view.document.getRoot()\n            );\n          });\n        }}\n        onChange={(event, editor) => {\n          setArticle({\n            ...article,\n            text: editor.getData(),\n          });\n        }}\n      />\n      <div className={classes.buttonContainer}>\n        {!articleToUpdate ? (\n          <Button color=\"primary\" variant=\"contained\" onClick={handleSubmit}>\n            {!isSending ? (\n              \"Publier\"\n            ) : (\n              <>\n                <i className=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i>\n              </>\n            )}\n          </Button>\n        ) : (\n          <Button color=\"primary\" variant=\"contained\" onClick={handleUpdate}>\n            {!isSending ? (\n              \"Modifier\"\n            ) : (\n              <>\n                <i className=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i>\n              </>\n            )}\n          </Button>\n        )}\n      </div>\n      <ModalBootsrap\n        handleClose={handleClose}\n        show={show}\n        title={\n          <>\n            {success ? \"Envoyé\" : \"Oups\"}\n            <i\n              className={`${\n                success ? \" fas fa-thumbs-up\" : \" fas fa-thumbs-down\"\n              }`}\n              style={{ color: \"#4caf50\", marginLeft: \"1rem\" }}\n            ></i>\n          </>\n        }\n      >\n        {success\n          ? \"Enregistrement avec succès.\"\n          : \"Une erreur s'est produite, veuillez réessayer.\"}\n      </ModalBootsrap>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}